# æµ‹è¯•æŒ‡å—

## ğŸ“¦ å·²å®‰è£…çš„æµ‹è¯•å·¥å…·

- **Vitest** - å¿«é€Ÿçš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼ˆåŸºäº Viteï¼‰
- **@testing-library/react** - React ç»„ä»¶æµ‹è¯•å·¥å…·
- **@testing-library/jest-dom** - DOM æ–­è¨€æ‰©å±•
- **happy-dom** - è½»é‡çº§ DOM ç¯å¢ƒï¼ˆæ¯” jsdom æ›´å¿«ï¼‰

## ğŸš€ è¿è¡Œæµ‹è¯•

```bash
# ç›‘å¬æ¨¡å¼ï¼ˆå¼€å‘æ—¶æ¨èï¼‰
yarn test

# UI ç•Œé¢æ¨¡å¼ï¼ˆå¯è§†åŒ–æŸ¥çœ‹æµ‹è¯•ï¼‰
yarn test:ui

# å•æ¬¡è¿è¡Œï¼ˆCI/CDï¼‰
yarn test:run

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
yarn test:coverage
```

## ğŸ“‚ æµ‹è¯•æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ dateUtils.ts
â”‚   â”œâ”€â”€ dateUtils.test.ts         âœ… æ—¥æœŸå·¥å…·å‡½æ•°æµ‹è¯•
â”‚   â”œâ”€â”€ utils.ts
â”‚   â””â”€â”€ utils.test.ts              âœ… é€šç”¨å·¥å…·å‡½æ•°æµ‹è¯•
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ daily/
â”‚   â”‚   â””â”€â”€ emotion/
â”‚   â”‚       â”œâ”€â”€ adapter.ts
â”‚   â”‚       â””â”€â”€ adapter.test.ts    âœ… æƒ…ç»ªæ•°æ®é€‚é…å™¨æµ‹è¯•
â”‚   â””â”€â”€ weekly-report/
â”‚       â”œâ”€â”€ adapter.ts
â”‚       â””â”€â”€ adapter.test.ts        âœ… å‘¨æŠ¥æ•°æ®é€‚é…å™¨æµ‹è¯•
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ globalStore.ts
â”‚   â””â”€â”€ globalStore.test.ts        âœ… å…¨å±€çŠ¶æ€ç®¡ç†æµ‹è¯•
â””â”€â”€ test/
    â””â”€â”€ setup.ts                   âš™ï¸ æµ‹è¯•ç¯å¢ƒé…ç½®
```

## ğŸ¯ æµ‹è¯•è¦†ç›–çš„å…³é”®æ¨¡å—

### 1. **æ—¥æœŸå·¥å…·å‡½æ•°** (`dateUtils.test.ts`)
âœ… é˜²æ­¢æ—¥æœŸè®¡ç®—é”™è¯¯å¯¼è‡´çš„æ•°æ®å±•ç¤ºé—®é¢˜

æµ‹è¯•å†…å®¹ï¼š
- æ—¥æœŸæ ¼å¼åŒ–ï¼ˆYYYY-MM-DDã€YYYY/MM/DDï¼‰
- å‘¨è¾¹ç•Œè®¡ç®—ï¼ˆMonday-Sundayï¼‰
- è·¨æœˆä»½ã€è·¨å¹´ä»½çš„æ—¥æœŸå¤„ç†
- å½“å‰å‘¨/ä¸Šä¸€å‘¨çš„æ—¥æœŸèŒƒå›´è®¡ç®—

**é‡è¦æ€§**ï¼šâ­â­â­â­â­  
å‘¨æŠ¥ã€æ—¥æŠ¥çš„æ—¶é—´èŒƒå›´é”™è¯¯ä¼šå¯¼è‡´æ˜¾ç¤ºé”™è¯¯çš„å†å²æ•°æ®ã€‚

---

### 2. **æ•°æ®é€‚é…å™¨** (`adapter.test.ts`)
âœ… é˜²æ­¢ API æ•°æ®è½¬æ¢é”™è¯¯å¯¼è‡´å›¾è¡¨æ¸²æŸ“é—®é¢˜

#### å‘¨æŠ¥é€‚é…å™¨æµ‹è¯•ï¼š
- API è¿”å› `null`/`undefined` çš„ä¿æŠ¤
- éƒ¨åˆ†æ•°æ®ä¸é»˜è®¤å€¼çš„åˆå¹¶
- å¤šä¸ªç”Ÿå‘½ä½“å¾è¶‹åŠ¿æ•°æ®çš„åˆå¹¶
- çŠ¶æ€ç­‰çº§é¢œè‰²æ˜ å°„

#### æƒ…ç»ªæ—¥æŠ¥é€‚é…å™¨æµ‹è¯•ï¼š
- å®Œæ•´ API å“åº”çš„è½¬æ¢
- ç©ºå­—æ®µçš„é»˜è®¤å€¼å¤„ç†
- å»ºè®®å›¾æ ‡è·¯å¾„çš„è‡ªåŠ¨æ·»åŠ 
- Demo æ•°æ®çš„æ ¼å¼éªŒè¯

**é‡è¦æ€§**ï¼šâ­â­â­â­â­  
è¿™æ˜¯æœ€å®¹æ˜“å‡º bug çš„åœ°æ–¹ï¼ŒAPI æ•°æ®æ ¼å¼å˜åŒ–ä¼šç›´æ¥å½±å“å‰ç«¯å±•ç¤ºã€‚

---

### 3. **å·¥å…·å‡½æ•°** (`utils.test.ts`)
âœ… éªŒè¯é€šç”¨å·¥å…·å‡½æ•°çš„æ­£ç¡®æ€§

æµ‹è¯•å†…å®¹ï¼š
- Tailwind ç±»ååˆå¹¶ï¼ˆ`cn` å‡½æ•°ï¼‰
- æ¡ä»¶ç±»åå¤„ç†
- åŠ¨ç”»é…ç½®çš„è·å–å’ŒéªŒè¯

**é‡è¦æ€§**ï¼šâ­â­â­  
å·¥å…·å‡½æ•°æ˜¯åŸºç¡€ï¼Œä½†ç›¸å¯¹ç¨³å®šã€‚

---

### 4. **å…¨å±€çŠ¶æ€ç®¡ç†** (`globalStore.test.ts`)
âœ… éªŒè¯ MobX store çš„çŠ¶æ€è½¬æ¢å’ŒæŒä¹…åŒ–

æµ‹è¯•å†…å®¹ï¼š
- ç™»å½•/ç™»å‡ºæµç¨‹
- Token çš„å­˜å‚¨å’Œæ¸…é™¤
- ä¸»é¢˜åˆ‡æ¢ï¼ˆlight/darkï¼‰
- è¯­è¨€åˆ‡æ¢ï¼ˆzh/enï¼‰
- localStorage æŒä¹…åŒ–

**é‡è¦æ€§**ï¼šâ­â­â­â­  
è®¤è¯çŠ¶æ€é”™è¯¯ä¼šå¯¼è‡´ç”¨æˆ·è¢«è«åç™»å‡ºæˆ–æ•°æ®ä¸¢å¤±ã€‚

---

## ğŸ“Š æµ‹è¯•ç­–ç•¥

### âœ… **å·²è¦†ç›–ï¼ˆé«˜ä»·å€¼ï¼‰**
- âœ… æ—¥æœŸ/æ—¶é—´è®¡ç®—
- âœ… æ•°æ®é€‚é…å±‚ï¼ˆAPI â†’ UIï¼‰
- âœ… çŠ¶æ€ç®¡ç†ï¼ˆç™»å½•/ä¸»é¢˜/è¯­è¨€ï¼‰
- âœ… å·¥å…·å‡½æ•°

### âš ï¸ **å¯é€‰è¦†ç›–ï¼ˆä¸­ç­‰ä»·å€¼ï¼‰**
- ç»„ä»¶äº¤äº’é€»è¾‘ï¼ˆæ—¥æœŸé€‰æ‹©å™¨ã€ä¸‹æ‹‰èœå•ï¼‰
- å¼‚å¸¸åœºæ™¯å¤„ç†ï¼ˆç½‘ç»œè¶…æ—¶ã€ç©ºæ•°æ®ï¼‰
- URL å‚æ•°è§£æ hooks

### âŒ **ä¸å»ºè®®æµ‹è¯•ï¼ˆä½ä»·å€¼ï¼‰**
- çº¯æ ·å¼ç»„ä»¶ï¼ˆç”¨å¯è§†åŒ–æµ‹è¯•æ›´åˆé€‚ï¼‰
- ç¬¬ä¸‰æ–¹åº“çš„é›†æˆï¼ˆRechartsã€i18nextï¼‰
- å¤æ‚çš„å›¾è¡¨æ¸²æŸ“ï¼ˆéš¾ä»¥è‡ªåŠ¨åŒ–éªŒè¯ï¼‰

## ğŸ“ ç¼–å†™æµ‹è¯•çš„æœ€ä½³å®è·µ

### 1. æµ‹è¯•æ–‡ä»¶å‘½å
```typescript
// è¢«æµ‹è¯•æ–‡ä»¶
src/lib/dateUtils.ts

// æµ‹è¯•æ–‡ä»¶ï¼ˆåŒç›®å½•ä¸‹ï¼‰
src/lib/dateUtils.test.ts
```

### 2. æµ‹è¯•ç»“æ„
```typescript
import { describe, it, expect } from 'vitest'
import { yourFunction } from './yourModule'

describe('æ¨¡å—å - åŠŸèƒ½æè¿°', () => {
  it('åº”è¯¥åšä»€ä¹ˆï¼ˆå…·ä½“åœºæ™¯ï¼‰', () => {
    // Arrange - å‡†å¤‡æ•°æ®
    const input = { ... }
    
    // Act - æ‰§è¡Œæ“ä½œ
    const result = yourFunction(input)
    
    // Assert - éªŒè¯ç»“æœ
    expect(result).toBe(expectedValue)
  })
})
```

### 3. æµ‹è¯•å‘½åè§„èŒƒ
âœ… **å¥½çš„æµ‹è¯•åç§°**ï¼š
```typescript
it('getWeekBounds å‘¨ä¸€åº”è¯¥è¿”å›å½“å‰å‘¨çš„Monday-Sunday', () => {})
it('adaptEmotionDailyData åº”è¯¥å¤„ç†ç©ºçš„å¯é€‰å­—æ®µ', () => {})
it('login åº”è¯¥æŒä¹…åŒ–åˆ° localStorage', () => {})
```

âŒ **ä¸å¥½çš„æµ‹è¯•åç§°**ï¼š
```typescript
it('test1', () => {})
it('should work', () => {})
it('getWeekBounds', () => {})
```

### 4. æ–­è¨€æŠ€å·§
```typescript
// åŸºç¡€æ–­è¨€
expect(value).toBe(expected)          // ä¸¥æ ¼ç›¸ç­‰
expect(value).toEqual(expected)       // æ·±åº¦ç›¸ç­‰
expect(value).toBeTruthy()            // çœŸå€¼
expect(value).toBeNull()              // null
expect(value).toBeDefined()           // å·²å®šä¹‰

// æ•°å­—æ–­è¨€
expect(score).toBeGreaterThan(0)
expect(score).toBeLessThanOrEqual(100)

// æ•°ç»„æ–­è¨€
expect(array).toHaveLength(5)
expect(array).toContain(item)

// å¯¹è±¡æ–­è¨€
expect(obj).toHaveProperty('key')
expect(obj).toMatchObject({ key: value })

// DOM æ–­è¨€ï¼ˆéœ€è¦ @testing-library/jest-domï¼‰
expect(element).toBeInTheDocument()
expect(element).toHaveClass('text-red-500')
expect(element).toHaveTextContent('Hello')
```

## ğŸ” å¦‚ä½•è¿è¡Œç‰¹å®šæµ‹è¯•

```bash
# è¿è¡Œç‰¹å®šæ–‡ä»¶
yarn test dateUtils.test.ts

# è¿è¡ŒåŒ¹é…æ¨¡å¼çš„æµ‹è¯•
yarn test adapter

# è¿è¡Œç‰¹å®šçš„ describe æˆ– it
yarn test -t "æ—¥æœŸæ ¼å¼åŒ–"
```

## ğŸ“ˆ æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡

```bash
yarn test:coverage
```

è¦†ç›–ç‡æŠ¥å‘Šä¼šç”Ÿæˆåœ¨ `coverage/` ç›®å½•ï¼Œæ‰“å¼€ `coverage/index.html` æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Šã€‚

**ç›®æ ‡è¦†ç›–ç‡**ï¼š
- å·¥å…·å‡½æ•°/é€‚é…å™¨ï¼š80%+
- çŠ¶æ€ç®¡ç†ï¼š70%+
- æ•´ä½“é¡¹ç›®ï¼šä¸è¿½æ±‚ 100%ï¼Œé‡ç‚¹å…³æ³¨æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

## ğŸ¨ å¯è§†åŒ–æµ‹è¯•ç•Œé¢

```bash
yarn test:ui
```

æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ Vitest UIï¼Œå¯ä»¥ï¼š
- æŸ¥çœ‹æ‰€æœ‰æµ‹è¯•çš„è¿è¡ŒçŠ¶æ€
- æŒ‰æ–‡ä»¶/æ¨¡å—è¿‡æ»¤æµ‹è¯•
- æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡çš„å¯è§†åŒ–æŠ¥å‘Š
- é‡æ–°è¿è¡Œå¤±è´¥çš„æµ‹è¯•

## ğŸš¨ CI/CD é›†æˆ

åœ¨ GitHub Actions æˆ–å…¶ä»– CI ä¸­è¿è¡Œï¼š

```yaml
# .github/workflows/test.yml
name: Test
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: yarn install
      - run: yarn test:run
```

## ğŸ’¡ ä¸‹ä¸€æ­¥å»ºè®®

1. **æ·»åŠ  E2E æµ‹è¯•**ï¼ˆå¯é€‰ï¼‰
   ```bash
   yarn add -D @playwright/test
   ```
   æµ‹è¯•å…³é”®ç”¨æˆ·æµç¨‹ï¼šç™»å½• â†’ æŸ¥çœ‹æŠ¥å‘Š â†’ åˆ‡æ¢æ—¥æœŸ

2. **æ·»åŠ å¯è§†åŒ–æµ‹è¯•**ï¼ˆå¯é€‰ï¼‰
   - ä½¿ç”¨ Playwright çš„ screenshot åŠŸèƒ½
   - æˆ–é›†æˆ Percy/Chromatic æœåŠ¡

3. **æŒç»­å®Œå–„æµ‹è¯•**
   - å‘ç° bug æ—¶ï¼Œå…ˆå†™æµ‹è¯•å¤ç°é—®é¢˜
   - é‡æ„ä»£ç æ—¶ï¼Œç¡®ä¿æµ‹è¯•é€šè¿‡
   - æ–°å¢åŠŸèƒ½æ—¶ï¼ŒåŒæ­¥ç¼–å†™æµ‹è¯•

---

**è®°ä½**ï¼šæµ‹è¯•ä¸æ˜¯ä¸ºäº†è¾¾åˆ° 100% è¦†ç›–ç‡ï¼Œè€Œæ˜¯ä¸ºäº†ï¼š
1. é˜²æ­¢é€€åŒ–ï¼ˆä¿®æ”¹ä»£ç æ—¶ä¸ç ´åå·²æœ‰åŠŸèƒ½ï¼‰
2. å¢å¼ºé‡æ„ä¿¡å¿ƒ
3. ä½œä¸ºä»£ç ä½¿ç”¨æ–‡æ¡£
4. å°½æ—©å‘ç° bugï¼ˆæ—©æœŸå‘ç°æˆæœ¬ä½ï¼‰
