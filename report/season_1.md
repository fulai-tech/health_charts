# 2026-Q1-季度-Review（健康生命体征可视化库）

**汇报人：** 黎文宇  
**周期：** 2026 Q1（Season 1）  
**项目：** Health Vital Visualization（React 18 + TypeScript + Vite + Tailwind + Radix UI + Recharts）

---

## 一、工作概述

本季度围绕“**健康生命体征可视化库**”完成了从**架构搭建 → 组件沉淀 → 多模块交付 → 性能与交互优化 → 联调与规范化反思**的一体化推进。

整体交付目标是：在 WebView/移动端场景下，提供**可独立嵌入的 Widget 组件页**与**可完整浏览的详情页/日报页**两套形态，并通过通用组件库与数据适配层，将“设计还原、性能体验、可维护性、可复用性”统一到一套工程化体系中。

---

## 二、主要工作内容及成果

### 1. Widget-First 架构落地（可嵌入组件页 + 详情页双形态）

- **路由体系成型**：明确区分三类页面  
  - `/details/*`：完整详情页（带布局与导航）  
  - `/widget/*`：仅渲染单一组件（透明背景，适配 iframe/App 嵌入）  
  - `/daily/*`：日报页面（移动端信息密度与交互优先）
- **布局解耦**：提供 `MainLayout` 与 `WidgetLayout`，实现“同一组件既可页面化，也可 Widget 化”的复用路径。
- **可验证的交付面**：仓库内覆盖多个指标详情页与 Widget 页（血压、血氧、心率、血糖等），并可通过 Home 页面快速导航验证。

### 2. 多生命体征模块的组件化交付（Details / Daily / Widgets）

- **详情页模块化拆分**：以 `features/*` 为中心组织代码，将血压、血糖、心率、血氧、睡眠、情绪、营养、健康看板拆分为独立 Feature。  
- **通用卡片沉淀**：形成可复用的业务卡片体系（统计、趋势、周概览、数据分析、AI 洞察等），降低后续新增指标的边际成本。  
- **日报链路补齐**：针对日报（健康/睡眠/情绪）形成独立目录与数据适配逻辑，保障移动端信息展示一致性。

### 3. “极致体验”导向的交互与动效优化（WebView 友好）

- **图表动效双模态**：实现“首帧静默渲染 + 数据到位后平滑过渡”的策略，解决 Recharts 在 WebView 下常见的抖动/闪烁问题。  
- **Tooltip 体验治理**：抽象通用 Hook，在页面滚动/触摸滚动时强制隐藏 Tooltip，修复 WebView/移动端 Tooltip 残留导致的遮挡问题。  
- **滑动手势体系**：  
  - 页面级：支持左右滑动切换周（并提供忽略子组件滑动的 `data-swipe-ignore` 机制，避免“页面滑动”和“图表/轮播滑动”冲突）  
  - 控件级：DateRangePicker 内置月视图左右滑动切换
- **加载体验升级**：从“转圈 Loading”转向“预加载 + 骨架/占位”，减少白屏与布局跳动（对 WebView 环境更友好）。

### 4. 高复用图表/卡片组件库沉淀（工程化复用率提升）

- **DistributionCard**：沉淀为“万能分布卡片”  
  - 支持单列/双列、计数模式、Highlight 模式、睡眠 duration 模式、情绪网格模式等多布局策略  
  - 将复杂图例、渐变填充、占位渲染统一收敛  
  - 结合本季度重构目标，复用率显著提升（周报口径：约 80%）
- **TrendLineChart**：沉淀为“通用趋势折线图”  
  - 支持面积填充、多线对比、动态阈值线、可配置 Legend  
  - 结合统一动画策略与 Tooltip 滚动治理，形成跨模块可用的趋势图能力
- **LazyChart**：图表进入视口再渲染，首屏多图情况下显著降低初始渲染压力。

### 5. 睡眠结构图“像素级还原”与算法攻坚

- **SleepStructureChart（Canvas）**：实现阶段块与阶段间连接的“丝滑渐变过渡”，并处理不同阶段切换时的圆角/高度差衔接。  
- **交互与性能兼顾**：自绘 + Portal Tooltip + 滚动隐藏策略，兼顾视觉与可用性。
- **团队协作沉淀**：与 **@艾小兵 / @胡泽涛 / @韦骁龙** 多轮对齐“睡眠状态切换组件必须完美还原 UI”的交付标准，并与 **@丁纪翔** 深入分析圆角算法高低与渐变色差问题，最终通过合理切割组件与算法策略解决关键难点，达成稳定交付。

### 6. 数据日期维度与“自然周”边界治理（对齐后端约束）

- **自然周统一入口**：抽象 `useWeekNavigation` 与 `dateUtils`，统一“周对齐（Mon-Sun）/API 参数格式/展示格式/未来周边界”逻辑。  
- **减少前端兜底复杂度**：通过 `canNavigateToNextWeek` 等约束，避免用户触发“未来周/不可用周”的请求异常。  
- **周维度数据对齐能力**：提供 `WEEKDAY_LABEL_MAP` 与 `ensureFullWeekData`，支持后端返回周几中文 label 时映射到 i18n Key，并补齐缺失天的数据占位，保证图表 X 轴稳定。

### 7. 国际化与主题体系

- **i18n 全局接入**：支持 `?lang=` 切换与本地缓存记忆，页面标题与导航统一使用翻译 Key。  
- **颜色与 UI 样式集中配置**：将颜色常量沉淀到主题配置中，统一各生命体征的主色、透明色、状态色与卡片样式，降低视觉维护成本。

### 8. 联调、部署与问题修复

- **多语言切换 Bug 修复**：支持多种语言格式（`en/zh` 等）并提供稳定切换体验。  
- **HTTPS/CORS 协助排障**：协助后端完成环境配置与跨域问题定位，保障端到端链路可用。  
- **团队协作进展（点名）**：  
  - **前端容器对接**：与 **@胡泽涛** 紧密配合，完成 WebView 内核的加载适配与调试，保障 H5 页面在原生应用容器中的稳定性。  
  - **部署交付**：协同 **@池文格** 完成构建打包与服务器部署流程验证，确保生产环境可访问与可演示。  
  - **极限数据与测试协作**：在 UI 极限压力测试与边界数据构造上，依赖并推动 **@乔路杰** 协助生成合理、有效的极限数据，用于验证极端情况下的布局稳定性与容错表现。

---

## 三、技术亮点与创新

### 1. 面向 AI 时代的“规范前置 / 架构先行”

- **核心认知转变**：在 AI 辅助编程下，瓶颈从“写代码”迁移到“**重构成本**”与“**规范定义**”。  
- **执行策略**：在新模块开发前优先输出 Interface/伪代码/数据契约，让 AI 生成始终服从既定解耦模式，减少后期“修修补补”的债务累积。

### 2. WebView 友好的图表体验体系

- “首帧静默 + 延迟启用动画”的双态动效策略  
- “滚动即隐藏 Tooltip”的交互治理策略  
- “预取上一周期数据 + 视口懒加载”的性能策略  
三者组合，使得“多图、多卡片”的页面在低端 WebView 场景下仍保持可用的流畅度与稳定性。

### 3. 复杂可视化的自绘落地能力

睡眠结构图采用 Canvas 自绘实现“渐变连接、圆角衔接、层级排序、Tooltip Portal”等能力，形成可复用的“复杂图表自绘工程经验”。

---

## 四、后续工作建议（下季度计划）

### 1. 推进“UI 驱动接口”的契约化落地

- **建议后端提供稳定英文 Key/ID**，避免前端通过顺序猜测卡片对应数据。  
- **接口文档标准化**：字段类型、空值策略、日期边界（当前/未来）、图片字段（URL/Base64）等统一定义，减少联调摩擦。

### 2. 完成移动端“滑动切换日期”组件落地（来自规划文档）

- 基于现有 `SwipeableCarousel` 抽象 `DateSwipeContainer` / `DateDisplay`，用于日报与详情页的“单日粒度”切换体验升级。  
- 与现有 DateRangePicker 的“周粒度”切换并存，形成统一的日期导航体系。

### 3. 进一步收敛“后端 label 不直出”的适配规范

当前仓库已经具备 `WEEKDAY_LABEL_MAP → i18n key` 的正确方向，但仍存在少量 demo/adapter 中的临时 label（中文或英文）与 `status_label` 直出场景。建议：

- **全面引入枚举/翻译 Key 映射**：把情绪/营养/睡眠等分类 label 统一映射到 i18n Key。  
- **完善状态文案规范**：`status_label` 等后端展示字段应转为 `status_code`（枚举）+ 前端翻译。

### 4. 性能与兼容性专项

- 针对“华为 WebView 内核裁剪/性能差”的问题，建立“设备矩阵 + 指标化”评估（首屏时间、交互延迟、滚动帧率）。  
- 持续优化多图页面的渲染时机与缓存策略（预取范围、缓存命中率、Skeleton 策略）。

---
> 备注：本报告内容综合了周报 `report/week1.md`、`report/week2.md`、`report/week3.md`、规划 `report/revise.md` 以及本周反思，并以仓库实际实现为依据进行归纳整理。
