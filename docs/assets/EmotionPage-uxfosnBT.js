import{C as e,E as t,S as n,T as r,at as i,g as a,h as o,r as s,rt as c,w as l}from"./vendor-DxyDeVV0.js";import"./vendor-charts-B__IZl80.js";import"./vendor-router-DvVHskPP.js";import{t as u}from"./vendor-query-BzUZE9-d.js";import{n as d}from"./vendor-i18n-BSzAmJZ7.js";import{n as f,s as p}from"./theme-XEO8amRP.js";import{t as m}from"./card-DR_iUne-.js";import{n as h,t as g}from"./useUrlParams-CgNyaJcn.js";import"./client-CzSh7g6B.js";import{t as _}from"./DistributionCard-D_3pQ4Tr.js";import"./useChartAnimation-DiAB65-P.js";import{t as v}from"./TrendLineChart-B7CWIoTy.js";import{t as y}from"./WeeklyOverviewCard-DICJkH00.js";import{a as b,t as x}from"./usePrefetchData-Dtc8Q6b7.js";import{t as S}from"./DisclaimerBox-CmM1idpz.js";import{t as C}from"./StackedBarChart-BFYVfq4k.js";import{t as w}from"./DataAnalysisCard-C8_RImdq.js";var T=i(),E=c();const D=(0,T.memo)(({level:e,size:t=48,className:n=``})=>{let r=t/48,i=14*r,a=8*r,o=18*r,s=10*r,c=3*r,l=18*r,u=12*r,d=14*r,f=e===`good`||e===`bad`?16*r:12*r,p=e===`good`||e===`bad`?8*r:2*r;return(0,E.jsxs)(`div`,{className:`relative rounded-full flex items-center justify-center ${n}`,style:{width:`${t}px`,height:`${t}px`,background:`#FFFFFF`,boxShadow:`0 0 0 ${1*r}px rgba(0, 0, 0, 0.06), 0 ${2*r}px ${10*r}px rgba(15, 23, 42, 0.06)`},children:[(0,E.jsx)(`div`,{className:`absolute rounded-full pointer-events-none`,style:{width:`${t*1.9}px`,height:`${t*1.9}px`,background:`radial-gradient(circle at 30% 35%, rgba(255, 168, 90, 0.95) 0%, rgba(255, 168, 90, 0.0) 55%), radial-gradient(circle at 65% 70%, rgba(255, 120, 200, 0.85) 0%, rgba(255, 120, 200, 0.0) 60%)`,filter:`blur(${22*r}px)`,opacity:.55,zIndex:-1,top:`50%`,left:`50%`,transform:`translate(-50%, -50%)`}}),(0,E.jsx)(`div`,{className:`absolute flex items-center justify-center`,style:{top:`${e===`good`?o:l}px`,left:`50%`,transform:`translateX(-50%)`,gap:`${e===`good`?s:u}px`},children:e===`good`?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(`div`,{style:{width:`${i}px`,height:`${a}px`,borderTop:`${3*r}px solid #F59E0B`,borderRadius:`${i/2}px ${i/2}px 0 0`,background:`transparent`}}),(0,E.jsx)(`div`,{style:{width:`${i}px`,height:`${a}px`,borderTop:`${3*r}px solid #F59E0B`,borderRadius:`${i/2}px ${i/2}px 0 0`,background:`transparent`}})]}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(`div`,{className:`rounded-full`,style:{width:`${c}px`,height:`${c}px`,background:`#FFA500`}}),(0,E.jsx)(`div`,{className:`rounded-full`,style:{width:`${c}px`,height:`${c}px`,background:`#FFA500`}})]})}),(0,E.jsx)(`div`,{className:`absolute left-1/2 -translate-x-1/2`,style:{bottom:`${d}px`},children:e===`good`?null:e===`bad`?(0,E.jsx)(`div`,{style:{width:`${f}px`,height:`${p}px`,borderTop:`${2*r}px solid #94A3B8`,borderRadius:`${f/2}px ${f/2}px 0 0`,transform:`translateY(${4*r}px)`}}):(0,E.jsx)(`div`,{className:`rounded-full`,style:{width:`${f}px`,height:`${p}px`,background:`#94A3B8`}})})]})});D.displayName=`EmotionFaceIcon`;var ee=(0,T.memo)(({active:e,payload:t})=>{var n;let{t:r}=d();if(!e||!t||t.length===0)return null;let i=(n=t[0])==null?void 0:n.payload;return!i||i.score===null?null:(0,E.jsxs)(`div`,{className:`bg-slate-700 text-white px-3 py-2 rounded-lg text-sm shadow-lg`,children:[(0,E.jsx)(`p`,{className:`font-medium mb-1`,children:r(i.weekdayKey)}),(0,E.jsxs)(`p`,{style:{color:f.primary},children:[r(`page.emotion.score`),`: `,i.score]})]})});const te=(0,T.memo)(({data:e,className:n,isLoading:i})=>{var a,o,c,l,u,h,g,_,y,b,x,S;let{t:C}=d(),w=(0,T.useMemo)(()=>{var t,n;return(t=e==null||(n=e.trendChartData)==null?void 0:n.map((e,t)=>({name:[`Mon`,`Tue`,`Wed`,`Thu`,`Fri`,`Sat`,`Sun`][t%7],weekdayKey:e.weekdayKey,score:e.score})))==null?[]:t},[e==null?void 0:e.trendChartData]);return(0,E.jsxs)(m,{className:`${n} relative overflow-hidden`,children:[(0,E.jsxs)(`div`,{className:`flex items-center gap-2 mb-4`,children:[(0,E.jsx)(s,{className:`w-5 h-5`,style:{color:f.primary}}),(0,E.jsx)(`h3`,{className:`text-base font-semibold text-slate-800`,children:C(`page.emotion.trendyReport`)})]}),(0,E.jsxs)(`div`,{className:`rounded-xl px-5 py-4 mb-4 mx-1`,style:{backgroundColor:p.background.warning},children:[(0,E.jsxs)(`div`,{className:`flex items-start justify-between mb-4`,children:[(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`p`,{className:`text-xs text-slate-500 mb-1`,children:C(`page.emotion.weeksAverage`)}),(0,E.jsxs)(`div`,{className:`flex items-baseline gap-1.5`,children:[(0,E.jsx)(`span`,{className:`text-3xl font-bold`,style:{color:f.primary},children:(a=e==null||(o=e.summary)==null?void 0:o.avgValue)==null?`--`:a}),(0,E.jsx)(`span`,{className:`text-lg text-slate-500`,children:C(`page.emotion.points`)}),(()=>{if(!e)return null;let{trend:n,changeValue:i}=e.summary;if(i===0)return null;let a=n===`up`;return(0,E.jsxs)(`span`,{className:`flex items-center gap-0.5 text-sm`,style:{color:a?`#10B981`:`#EF4444`},children:[(0,E.jsx)(a?r:t,{className:`w-3 h-3`}),Math.abs(i)]})})()]}),(0,E.jsxs)(`p`,{className:`text-xs text-slate-400 mt-0.5`,children:[C(`time.lastWeek`),`: `,(c=e==null||(l=e.summary)==null?void 0:l.previousAvg)==null?`--`:c,` `,C(`page.emotion.points`)]})]}),(()=>{var t,n;let r=(e==null||(t=e.summary)==null?void 0:t.emotionLevel)||`neutral`,i=(e==null||(n=e.summary)==null?void 0:n.emotionLabel)||`--`;return(0,E.jsxs)(`div`,{className:`flex flex-col items-center gap-1.5`,children:[(0,E.jsx)(D,{level:r,size:48}),(0,E.jsx)(`span`,{className:`text-[10px] font-medium text-slate-500 whitespace-nowrap`,children:i})]})})()]}),(0,E.jsxs)(`div`,{className:`flex gap-6`,children:[(0,E.jsxs)(`div`,{children:[(0,E.jsxs)(`span`,{className:`text-xs text-slate-400`,children:[C(`common.max`),`(`,e?C(e.summary.maxWeekdayKey):`--`,`)`]}),(0,E.jsxs)(`p`,{className:`text-xl font-semibold`,style:{color:f.primary},children:[(u=e==null||(h=e.summary)==null?void 0:h.maxValue)==null?`--`:u,` `,(0,E.jsx)(`span`,{className:`text-sm font-normal`,children:C(`page.emotion.points`)})]})]}),(0,E.jsxs)(`div`,{children:[(0,E.jsxs)(`span`,{className:`text-xs text-slate-400`,children:[C(`common.min`),`(`,e?C(e.summary.minWeekdayKey):`--`,`)`]}),(0,E.jsxs)(`p`,{className:`text-xl font-semibold text-slate-600`,children:[(g=e==null||(_=e.summary)==null?void 0:_.minValue)==null?`--`:g,` `,(0,E.jsx)(`span`,{className:`text-sm font-normal`,children:C(`page.emotion.points`)})]})]})]})]}),(0,E.jsx)(v,{data:w,lines:[{dataKey:`score`,color:f.primary,label:C(`page.emotion.score`),showArea:!0,gradientId:`emotionLineGradient`,legendShape:`circle`}],xAxisKey:`name`,yAxisDomain:[(y=e==null||(b=e.yAxisRange)==null?void 0:b.min)==null?0:y,(x=e==null||(S=e.yAxisRange)==null?void 0:S.max)==null?100:x],renderTooltip:e=>(0,E.jsx)(ee,{...e}),showLegend:!1,height:224})]})});var O=(0,T.memo)(({active:e,payload:t})=>{var n;let{t:r}=d();if(!e||!t||t.length===0)return null;let i=(n=t[0])==null?void 0:n.payload;return i?(0,E.jsxs)(`div`,{className:`bg-slate-700 text-white px-3 py-2 rounded-lg text-sm shadow-lg`,children:[(0,E.jsx)(`p`,{className:`font-medium mb-1`,children:r(i.weekdayKey)}),(0,E.jsxs)(`p`,{style:{color:f.positive},children:[r(`page.emotion.positive`),`: `,i.positivePercent,`%`]}),(0,E.jsxs)(`p`,{style:{color:f.neutral},children:[r(`page.emotion.neutral`),`: `,i.neutralPercent,`%`]}),(0,E.jsxs)(`p`,{style:{color:f.negative},children:[r(`page.emotion.negative`),`: `,i.negativePercent,`%`]})]}):null});const k=(0,T.memo)(({data:t,className:n,isLoading:r})=>{let{t:i}=d(),a=(0,T.useMemo)(()=>{var e,n;return(e=t==null||(n=t.compositionData)==null?void 0:n.map((e,t)=>({name:[`Mon`,`Tue`,`Wed`,`Thu`,`Fri`,`Sat`,`Sun`][t%7],weekdayKey:e.weekdayKey,positivePercent:e.positivePercent,neutralPercent:e.neutralPercent,negativePercent:e.negativePercent})))==null?[]:e},[t==null?void 0:t.compositionData]),o=[{dataKey:`positivePercent`,color:f.positive,label:i(`page.emotion.positive`)},{dataKey:`neutralPercent`,color:f.neutral,label:i(`page.emotion.neutral`)},{dataKey:`negativePercent`,color:f.negative,label:i(`page.emotion.negative`)}];return(0,E.jsxs)(m,{className:`${n} relative overflow-hidden`,children:[(0,E.jsxs)(`div`,{className:`flex items-center gap-2 mb-4`,children:[(0,E.jsx)(e,{className:`w-5 h-5`,style:{color:f.primary}}),(0,E.jsx)(`h3`,{className:`text-base font-semibold text-slate-800`,children:i(`page.emotion.statistics`)})]}),(0,E.jsx)(C,{data:a,layers:o,xAxisKey:`name`,yAxisDomain:[0,100],yAxisFormatter:e=>`${e}%`,legendShape:`square`,renderTooltip:e=>(0,E.jsx)(O,{...e}),stackId:`emotion`,height:224})]})});var A={happy:f.happy,surprised:f.surprised,calm:f.calm,sad:f.sad,angry:f.angry,fearful:f.fearful,disgusted:f.disgusted,neutral:f.calm};const j=(0,T.memo)(({data:e,className:t,isLoading:r})=>{var i,a,o,s;let{t:c}=d(),l=f.primary,u=(i=e==null||(a=e.distribution)==null?void 0:a.distribution)==null?[]:i,p=(o=e==null||(s=e.distribution)==null?void 0:s.dominantEmotion)==null?``:o,m=(0,T.useMemo)(()=>u.map(e=>({type:e.type,label:e.label,percent:e.percent,count:e.count,color:A[e.type]||f.calm})),[u]);return(0,E.jsx)(_,{title:c(`page.emotion.distribution`),icon:n,themeColor:l,pieChartSize:`medium`,items:m,centerValue:p||c(`page.emotion.neutral`),centerLabel:`as main`,showCount:!1,columns:2,className:t})});function M({data:e,className:t}){var n;let{t:r}=d(),i=(e==null||(n=e.weeklySummary)==null?void 0:n.dataAnalysis)||[],o=[r(`page.emotion.defaultAnalysis1`,{defaultValue:`æ‚¨çš„æƒ…ç»ªä»¥ç§¯æžä¸ºä¸»ï¼Œæ•´ä½“çŠ¶æ€è‰¯å¥½`}),r(`page.emotion.defaultAnalysis2`,{defaultValue:`æƒ…ç»ªæ³¢åŠ¨åœ¨æ­£å¸¸èŒƒå›´å†…ï¼Œæƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›è¾ƒå¼º`}),r(`page.emotion.defaultAnalysis3`,{defaultValue:`å»ºè®®ç»§ç»­ä¿æŒç§¯æžçš„ç”Ÿæ´»æ€åº¦ï¼Œé€‚å½“è¿›è¡Œæ”¾æ¾è®­ç»ƒ`})];return(0,E.jsx)(w,{titleKey:`page.emotion.dataAnalysis`,Icon:a,items:i.length>0?i:o,themeColor:f.primary,className:t})}function N({data:e,className:t}){let{t:n}=d(),r=e==null?void 0:e.weeklySummary;return(0,E.jsx)(y,{titleKey:`page.emotion.weeklyOverview`,Icon:o,overallText:(r==null?void 0:r.overview)||n(`page.emotion.defaultOverview`,{defaultValue:`æœ¬å‘¨æ‚¨çš„æƒ…ç»ªæ•´ä½“å¤„äºŽç§¯æžçŠ¶æ€ã€‚ç»§ç»­ä¿æŒè‰¯å¥½çš„å¿ƒæ€å’Œç”Ÿæ´»ä¹ æƒ¯ï¼`}),highlightText:(r==null?void 0:r.highlights)||n(`page.emotion.defaultHighlights`,{defaultValue:`è¶‹åŠ¿å›¾æ˜¾ç¤ºæ‚¨çš„æƒ…ç»ªåœ¨æœ¬å‘¨ä¸­æœ‰ä¸€äº›æ³¢åŠ¨ã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œå¯èƒ½ä¼šå—åˆ°å·¥ä½œåŽ‹åŠ›ã€ç¡çœ è´¨é‡å’Œç¤¾äº¤æ´»åŠ¨çš„å½±å“ã€‚`}),highlightLabelKey:`page.emotion.needsAttention`,highlightColor:`#FBBF24`,suggestions:r==null?void 0:r.suggestions,themeColor:f.primary,className:t})}var P={å¼€å¿ƒ:f.happy,ç”Ÿæ°”:f.angry,å¹³é™:f.calm,åº†å¹¸:f.surprised,æ‚²ä¼¤:f.sad,ææƒ§:f.fearful,åŽŒæ¶:f.disgusted,Happy:f.happy,Angry:f.angry,Calm:f.calm,Surprised:f.surprised,Sad:f.sad,Fearful:f.fearful,Disgusted:f.disgusted},F=`#FB923D`,I=`#D1D5DB`,L=(0,T.memo)(({diary:e})=>(0,E.jsx)(`div`,{className:`w-full flex-shrink-0 px-1`,children:(0,E.jsxs)(`div`,{className:`bg-slate-50 rounded-2xl p-4 relative overflow-hidden`,children:[(0,E.jsxs)(`div`,{className:`mb-3`,children:[(0,E.jsx)(`h4`,{className:`text-base font-semibold text-slate-800 mb-1`,children:e.title}),(0,E.jsxs)(`div`,{className:`text-xs text-slate-400`,children:[e.dateLabel,` `,e.weekLabel,` `,e.timeLabel]})]}),(0,E.jsx)(`p`,{className:`text-sm text-slate-600 leading-relaxed mb-4`,children:e.content}),e.imageUrl&&(0,E.jsx)(`div`,{className:`mb-4 -mx-4 px-4`,children:(0,E.jsx)(`div`,{className:`rounded-xl overflow-hidden`,children:(0,E.jsx)(`img`,{src:e.imageUrl,alt:e.title,className:`w-full h-auto max-h-64 object-contain`,style:{backgroundColor:`transparent`},onError:e=>{e.currentTarget.style.display=`none`}})})}),(0,E.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:e.emotionTags.map((e,t)=>(0,E.jsxs)(`span`,{className:`px-3 py-1 rounded-full text-xs text-white font-medium`,style:{backgroundColor:P[e]||f.calm},children:[`# `,e]},t))}),(0,E.jsx)(`div`,{className:`absolute bottom-0 right-0 w-12 h-12`,style:{background:`linear-gradient(135deg, transparent 50%, rgba(148, 163, 184, 0.15) 50%)`}})]})})),R=(0,T.memo)(({total:e,current:t,onSelect:n})=>e<=1?null:(0,E.jsx)(`div`,{className:`flex justify-center items-center gap-2 mt-4`,children:Array.from({length:e}).map((e,r)=>(0,E.jsx)(`button`,{onClick:()=>n(r),className:`transition-all duration-300`,style:{width:r===t?24:8,height:8,borderRadius:4,backgroundColor:r===t?F:I},"aria-label":`Go to slide ${r+1}`},r))}));const z=(0,T.memo)(({data:e,className:t,isLoading:n})=>{var r,i;let{t:a}=d(),[o,s]=(0,T.useState)(0),c=(0,T.useRef)(null),u=(0,T.useRef)(0),p=(0,T.useRef)(0),h=(0,T.useRef)(0),g=(0,T.useRef)(!1),[_,v]=(0,T.useState)(0),y=(r=e==null?void 0:e.diaries)==null?[]:r;(0,T.useEffect)(()=>{s(0)},[y.length]);let b=(0,T.useCallback)(e=>{u.current=e.touches[0].clientX,p.current=e.touches[0].clientY,g.current=!1,v(0)},[]),x=(0,T.useCallback)(e=>{let t=e.touches[0].clientX,n=e.touches[0].clientY,r=t-u.current,i=n-p.current;if(Math.abs(r)>Math.abs(i)&&Math.abs(r)>10){g.current=!0,e.preventDefault();let t=r;(o===0&&r>0||o===y.length-1&&r<0)&&(t=r*.3),v(t)}h.current=t},[o,y.length]),S=(0,T.useCallback)(()=>{let e=h.current-u.current;g.current&&(e>50&&o>0?s(e=>e-1):e<-50&&o<y.length-1&&s(e=>e+1)),v(0),g.current=!1,u.current=0,h.current=0},[o,y.length]),C=(0,T.useCallback)(e=>{s(e)},[]),w=((i=c.current)==null?void 0:i.offsetWidth)||0,D=-o*100;return w>0&&_/w*100,(0,E.jsxs)(m,{className:`${t} relative overflow-hidden`,children:[(0,E.jsxs)(`div`,{className:`flex items-center gap-2 mb-4`,children:[(0,E.jsx)(l,{className:`w-5 h-5`,style:{color:f.primary}}),(0,E.jsx)(`h3`,{className:`text-base font-semibold text-slate-800`,children:a(`page.emotion.diary`)})]}),y.length>0?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(`div`,{ref:c,className:`relative overflow-hidden touch-pan-y`,onTouchStart:b,onTouchMove:x,onTouchEnd:S,style:{touchAction:`pan-y pinch-zoom`},children:(0,E.jsx)(`div`,{className:`flex`,style:{transform:`translateX(calc(${D}% + ${_}px))`,transition:_===0?`transform 0.3s ease-out`:`none`},children:y.map(e=>(0,E.jsx)(L,{diary:e},e.diaryId))})}),(0,E.jsx)(R,{total:y.length,current:o,onSelect:C})]}):(0,E.jsx)(`div`,{className:`text-center py-8 text-slate-400 text-sm`,children:a(`common.noData`)})]})});var B=`emotion_demo_mode`;function V(){try{return localStorage.getItem(B)===`true`}catch(e){return console.warn(`[Emotion Demo Mode] Failed to read from localStorage:`,e),!1}}function H(){try{localStorage.setItem(B,`true`),console.log(`âœ… [Emotion Demo Mode] Enabled - Using dummy data`)}catch(e){console.error(`[Emotion Demo Mode] Failed to enable:`,e)}}function U(){try{localStorage.setItem(B,`false`),console.log(`âœ… [Emotion Demo Mode] Disabled - Using backend data`)}catch(e){console.error(`[Emotion Demo Mode] Failed to disable:`,e)}}function W(){let e=!V();return e?H():U(),e}function G({className:e=``,onChange:t}){let{t:n}=d(),[r,i]=(0,T.useState)(V);return(0,T.useEffect)(()=>{i(V())},[]),(0,E.jsxs)(`div`,{className:`flex items-center gap-3 ${e}`,children:[(0,E.jsx)(`span`,{className:`text-sm font-medium text-slate-700`,children:n(`page.emotion.demoMode`,`Demo Mode`)}),(0,E.jsx)(`button`,{onClick:()=>{let e=W();i(e),t==null||t(e),window.location.reload()},className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 ${r?`bg-purple-500`:`bg-slate-300`}`,role:`switch`,"aria-checked":r,"aria-label":n(`page.emotion.toggleDemoMode`,`Toggle demo mode`),children:(0,E.jsx)(`span`,{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${r?`translate-x-6`:`translate-x-1`}`})}),(0,E.jsx)(`span`,{className:`text-xs text-slate-500`,children:r?n(`page.emotion.demoModeOn`,`Using dummy data`):n(`page.emotion.demoModeOff`,`Using backend data`)})]})}var K={å‘¨ä¸€:`weekdays.mon`,å‘¨äºŒ:`weekdays.tue`,å‘¨ä¸‰:`weekdays.wed`,å‘¨å››:`weekdays.thu`,å‘¨äº”:`weekdays.fri`,å‘¨å…­:`weekdays.sat`,å‘¨æ—¥:`weekdays.sun`};function q(e){let t=new Date(e);return`${String(t.getMonth()+1).padStart(2,`0`)}/${String(t.getDate()).padStart(2,`0`)}`}function ne(e){return e===`up`||e===`dn`||e===`same`?e:`same`}function re(e){return e===`good`||e===`neutral`||e===`bad`?e:`neutral`}function J(){let e=new Date,t=[],n=[],r=[78,82,75,88,85,90,86],i=[25,30,20,35,32,40,38],a=[55,50,60,45,48,42,44],o=[20,20,20,20,20,18,18];for(let s=6;s>=0;s--){let c=new Date(e);c.setDate(c.getDate()-s);let l=c.getDay(),u=[`weekdays.sun`,`weekdays.mon`,`weekdays.tue`,`weekdays.wed`,`weekdays.thu`,`weekdays.fri`,`weekdays.sat`],d=6-s;t.push({date:c,dateLabel:q(c.toISOString().split(`T`)[0]),weekdayKey:u[l],score:r[d]}),n.push({date:c,dateLabel:q(c.toISOString().split(`T`)[0]),weekdayKey:u[l],positivePercent:i[d],neutralPercent:a[d],negativePercent:o[d],positiveCount:Math.round(i[d]/5),neutralCount:Math.round(a[d]/5),negativeCount:Math.round(o[d]/5)})}return{trendChartData:t,yAxisRange:{min:0,max:100},compositionData:n,summary:{avgValue:85,previousAvg:86,maxValue:88,maxWeekdayKey:`weekdays.tue`,minValue:82,minWeekdayKey:`weekdays.mon`,emotionLevel:`good`,emotionLabel:`ç§¯æžå‘å¥½`,trend:`dn`,changeValue:1},distribution:{totalCount:55,dominantEmotion:`å¹³é™`,distribution:[{type:`happy`,label:`å¼€å¿ƒ`,count:4,percent:7},{type:`angry`,label:`ç”Ÿæ°”`,count:5,percent:9},{type:`neutral`,label:`å¹³é™`,count:45,percent:82},{type:`surprised`,label:`åº†å¹¸`,count:0,percent:0},{type:`sad`,label:`æ‚²ä¼¤`,count:1,percent:2},{type:`fearful`,label:`ææƒ§`,count:0,percent:0},{type:`disgusted`,label:`åŽŒæ¶`,count:0,percent:0}]},comparison:{current:{average:85},previous:{average:86},insight:null},weeklySummary:{overview:`æœ¬å‘¨"å¼€å¿ƒ"ä¸Ž"å¹³é™"å æ¯”åˆè®¡è¾¾ 72%ã€‚å‘¨å…­çš„æˆ·å¤–æ´»åŠ¨æ˜¾è‘—æå‡äº†æ‚¨çš„æ„‰æ‚¦æŒ‡æ•°ã€‚`,highlights:`å‘¨äºŒå‡ºçŽ°çŸ­æš‚çš„"ç–²æƒ«/æ‚²ä¼¤"æƒ…ç»ªï¼Œä¸»è¦ä¸Žå·¥ä½œåŽ‹åŠ›åŠå‰ä¸€æ™šç¡çœ ä¸è¶³æœ‰å…³ã€‚`,suggestions:[],dataAnalysis:[`æ‚¨çš„æƒ…ç»ªä»¥ç§¯æžä¸ºä¸»ï¼Œæ•´ä½“çŠ¶æ€è‰¯å¥½`,`æƒ…ç»ªæ³¢åŠ¨åœ¨æ­£å¸¸èŒƒå›´å†…ï¼Œæƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›è¾ƒå¼º`,`å»ºè®®ç»§ç»­ä¿æŒç§¯æžçš„ç”Ÿæ´»æ€åº¦ï¼Œé€‚å½“è¿›è¡Œæ”¾æ¾è®­ç»ƒ`]},diaries:[{diaryId:`dummy-1`,title:`é’±åŒ…å¤±è€Œå¤å¾—`,weekLabel:`å‘¨å›› Thu`,dateLabel:`Nov.21`,timeLabel:`20:22`,content:`ä»Šå¤©å‡ºé—¨ä¹°èœæ—¶ä¸å°å¿ƒæŠŠé’±åŒ…è½åœ¨äº†è¶…å¸‚ï¼Œå›žå®¶æ‰å‘çŽ°ã€‚æ­£ç€æ€¥çš„æ—¶å€™ï¼Œè¶…å¸‚æ‰“æ¥ç”µè¯è¯´æœ‰äººæ¡åˆ°äº¤ç»™äº†æœåŠ¡å°ã€‚çœŸæ˜¯å¤ªæ„Ÿè°¢é‚£ä½å¥½å¿ƒäººäº†ï¼Œä¸–ç•Œè¿˜æ˜¯å¥½äººå¤šå•Šï¼`,emotionTags:[`åº†å¹¸`],imageUrl:`/images/emotion/wallet.png`},{diaryId:`dummy-2`,title:`ç¤¾åŒºæ´»åŠ¨çœŸçƒ­é—¹`,weekLabel:`å‘¨äº” Fri`,dateLabel:`Nov.22`,timeLabel:`15:30`,content:`ä»Šå¤©å‚åŠ äº†ç¤¾åŒºç»„ç»‡çš„è€å¹´äººè”è°Šä¼šï¼Œè§åˆ°äº†å¥½å¤šè€æœ‹å‹ã€‚å¤§å®¶ä¸€èµ·èŠå¤©ã€ä¸‹æ£‹ã€å”±æ­Œï¼Œåº¦è¿‡äº†æ„‰å¿«çš„ä¸‹åˆã€‚æ´»åŠ¨ç»“æŸåŽè¿˜ä¸€èµ·åˆå½±ç•™å¿µï¼ŒçœŸå¸Œæœ›è¿™æ ·çš„æ´»åŠ¨èƒ½å¤šä¸¾åŠžå‡ æ¬¡ã€‚`,emotionTags:[`å¼€å¿ƒ`],imageUrl:`/images/emotion/meeting.png`},{diaryId:`dummy-3`,title:`æœŸå¾…å·²ä¹…çš„å®¶åº­èšé¤`,weekLabel:`å‘¨ä¸€ Mon`,dateLabel:`Nov.24`,timeLabel:`19:33`,content:`ä»Šå¤©å­©å­ä»¬éƒ½å›žæ¥äº†ï¼Œæˆ‘ç‰¹æ„åšäº†ä»–ä»¬çˆ±åƒçš„çº¢çƒ§è‚‰ã€‚å°å­™å­è®²äº†å¾ˆå¤šå­¦æ ¡çš„äº‹æƒ…ï¼Œå¥³å„¿ä¹Ÿåˆ†äº«äº†å·¥ä½œä¸Šçš„è¶£äº‹ã€‚ä¸€å®¶äººå›´ååœ¨ä¸€èµ·åƒé¥­èŠå¤©ï¼Œè¿™ç§æ¸©é¦¨çš„æ„Ÿè§‰çœŸå¥½ã€‚`,emotionTags:[`å¼€å¿ƒ`],imageUrl:`/images/emotion/daughter.png`}]}}function Y(e){var t,n,r,i,a;if(console.log(`[Emotion Adapter] Input:`,e),!e)return console.warn(`[Emotion Adapter] No API data, using dummy data`),J();let o=((e==null||(t=e.trend_chart)==null?void 0:t.chart_data)||[]).map(e=>({date:new Date(e.date),dateLabel:q(e.date),weekdayKey:K[e.label]||`weekdays.mon`,score:e.score})),s=((e==null||(n=e.emotion_composition)==null?void 0:n.chart_data)||[]).map(e=>({date:new Date(e.date),dateLabel:q(e.date),weekdayKey:K[e.label]||`weekdays.mon`,positivePercent:e.positive_percent,neutralPercent:e.neutral_percent,negativePercent:e.negative_percent,positiveCount:e.positive_count,neutralCount:e.neutral_count,negativeCount:e.negative_count})),c=((e==null?void 0:e.emotion_diaries)||[]).map(e=>({diaryId:e.diary_id,title:e.title,weekLabel:e.week_label,dateLabel:e.date_label,timeLabel:e.time_label,content:e.content,emotionTags:e.emotion_tag||[],imageUrl:e.image_url})),l=(e==null?void 0:e.overview)||{},u=l.average||0,d=l.previous_average||0,f=l.max||0,p=l.min||0,m=l.max_label&&K[l.max_label]||`weekdays.mon`,h=l.min_label&&K[l.min_label]||`weekdays.mon`,g=re(l.emotion_level),_=l.emotion_label||``,v=l.change||{},y=ne(v.trend),b=v.value||0,x=(e==null?void 0:e.emotion_distribution)||{},S={totalCount:x.total_count||0,dominantEmotion:x.dominant_emotion||``,distribution:(x.distribution||[]).map(e=>({type:e.type,label:e.label,count:e.count,percent:e.percent}))},C=(e==null?void 0:e.comparison)||{},w=(e==null?void 0:e.weekly_summary)||{},T={trendChartData:o.length>0?o:J().trendChartData,yAxisRange:(e==null||(r=e.trend_chart)==null?void 0:r.y_axis_range)||{min:0,max:100},compositionData:s.length>0?s:J().compositionData,summary:{avgValue:u,previousAvg:d,maxValue:f,maxWeekdayKey:m,minValue:p,minWeekdayKey:h,emotionLevel:g,emotionLabel:_,trend:y,changeValue:b},distribution:S,comparison:{current:{average:((i=C.current)==null?void 0:i.average)||u},previous:{average:((a=C.previous)==null?void 0:a.average)||d},insight:C.insight||null},weeklySummary:{overview:w.overview||null,highlights:w.highlights||null,suggestions:w.suggestions||[],dataAnalysis:w.data_analysis||[]},diaries:c.length>0?c:J().diaries};return console.log(`[Emotion Adapter] Output:`,T),T}const X={all:[`emotion`],trend:(e,t)=>[...X.all,`trend`,e==null?void 0:e.startDate,e==null?void 0:e.endDate,t?`demo`:`live`],details:()=>[...X.all,`details`]};async function Z(e){try{return await b(`emotion`,e)}catch(e){return console.warn(`[Emotion API] API not available, using dummy data:`,e),null}}function ie(e){let t=V();return u({queryKey:X.trend(e,t),queryFn:async()=>{if(t)return console.log(`ðŸŽ­ [Emotion Demo Mode] Using dummy data instead of backend API`),J();console.log(`[Emotion API] Fetching with dateRange:`,e);let n=await Z(e?{start_date:e.startDate,end_date:e.endDate}:void 0);return console.log(`[Emotion API] Result:`,n),Y(n)},staleTime:300*1e3,gcTime:600*1e3})}function ae(){let e=V();return x({featureName:`Emotion`,queryKeyFn:t=>X.trend(t,e),fetchFn:async t=>{if(e)return J();try{return Y(await Z({start_date:t.startDate,end_date:t.endDate}))}catch(e){return J()}}})}function Q(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,`0`)}-${String(e.getDate()).padStart(2,`0`)}`}function $(e){return`${e.getFullYear()}/${String(e.getMonth()+1).padStart(2,`0`)}/${String(e.getDate()).padStart(2,`0`)}`}function oe(){let{t:e}=d(),{theme:t}=g(),{prefetchPreviousWeeks:n}=ae(),[r,i]=(0,T.useState)(()=>{let e=new Date,t=new Date;return t.setDate(e.getDate()-6),{start:t,end:e}});(0,T.useEffect)(()=>{n(r.end,3)},[r.end,n]);let a=(0,T.useMemo)(()=>{let e=new Date;e.setHours(0,0,0,0);let t=new Date(r.end);return t.setHours(0,0,0,0),t<e},[r.end]),o=(0,T.useMemo)(()=>({startDate:Q(r.start),endDate:Q(r.end)}),[r]),s=(0,T.useMemo)(()=>({start:$(r.start),end:$(r.end)}),[r]),c=()=>{i(e=>{let t=new Date(e.start),n=new Date(e.end);return t.setDate(t.getDate()-7),n.setDate(n.getDate()-7),{start:t,end:n}})},l=()=>{a&&i(e=>{let t=new Date(e.start),n=new Date(e.end);t.setDate(t.getDate()+7),n.setDate(n.getDate()+7);let r=new Date;return n>r&&(n.setTime(r.getTime()),t.setTime(r.getTime()),t.setDate(t.getDate()-6)),{start:t,end:n}})},{data:u,isLoading:f,isFetching:p,error:m}=ie(o);return m?(0,E.jsx)(`div`,{className:`min-h-screen flex items-center justify-center p-4`,style:{backgroundColor:t.background},children:(0,E.jsxs)(`div`,{className:`text-center`,children:[(0,E.jsx)(`p`,{className:`text-red-500 mb-2`,children:e(`common.error`)}),(0,E.jsx)(`p`,{className:`text-sm`,style:{color:t.textSecondary},children:String(m)})]})}):(0,E.jsx)(`div`,{className:`min-h-screen pb-20`,style:{backgroundColor:t.background},children:(0,E.jsxs)(`div`,{className:`max-w-2xl mx-auto`,children:[(0,E.jsxs)(`div`,{className:`sticky top-0 z-20 py-3 px-4`,style:{backgroundColor:t.background},children:[(0,E.jsx)(`div`,{className:`flex justify-center`,children:(0,E.jsx)(h,{startDate:s.start,endDate:s.end,onPrevious:c,onNext:l,disableNext:!a})}),(0,E.jsx)(`div`,{className:`flex justify-center mt-3`,children:(0,E.jsx)(G,{})})]}),(0,E.jsx)(`div`,{className:`px-4 space-y-4`,children:!u&&!f?(0,E.jsx)(`div`,{className:`text-center py-12`,children:(0,E.jsx)(`p`,{className:`text-slate-500`,children:e(`common.noData`)})}):(0,E.jsxs)(`div`,{className:`space-y-4`,children:[(0,E.jsx)(te,{data:u}),(0,E.jsx)(k,{data:u}),(0,E.jsx)(j,{data:u}),(0,E.jsx)(M,{data:u}),(0,E.jsx)(N,{data:u}),(0,E.jsx)(z,{data:u}),(0,E.jsx)(S,{})]})})]})})}export{oe as EmotionPage};