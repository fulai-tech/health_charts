import{C as e,E as t,O as n,T as r,at as i,h as a,r as o,rt as s,u as c}from"./vendor-DxyDeVV0.js";import{t as l}from"./vendor-query-BzUZE9-d.js";import{n as u}from"./vendor-i18n-BSzAmJZ7.js";import{c as d,l as f,o as p,s as m}from"./theme-XEO8amRP.js";import{t as h}from"./card-DR_iUne-.js";import{t as g}from"./DistributionCard-D_3pQ4Tr.js";import{t as _}from"./TrendLineChart-B7CWIoTy.js";import{t as v}from"./WeeklyOverviewCard-DICJkH00.js";import{s as y,t as b}from"./usePrefetchData-Dtc8Q6b7.js";import{t as x}from"./DataAnalysisCard-C8_RImdq.js";var S=i(),C=s(),w=(0,S.memo)(({active:e,payload:t})=>{var n;let{t:r}=u();if(!e||!t||t.length===0)return null;let i=(n=t[0])==null?void 0:n.payload;return i?(0,C.jsxs)(`div`,{className:`bg-slate-700 text-white px-3 py-2 rounded-lg text-sm shadow-lg`,children:[(0,C.jsx)(`p`,{className:`font-medium mb-1`,children:r(i.weekdayKey)}),(0,C.jsxs)(`p`,{className:`text-cyan-300`,children:[r(`common.max`),`: `,i.max,`%`]}),(0,C.jsxs)(`p`,{className:`text-cyan-200`,children:[r(`common.min`),`: `,i.min,`%`]})]}):null});function T({data:e,className:n,isLoading:i}){var a,s,l,p,g,v,y,b,x,T,E,D,O;let{t:k}=u(),A=f.spo2,j=(0,S.useMemo)(()=>[{name:`Mon`,weekdayKey:`weekday.mon`,range:[96,99],avg:97,max:99,min:96},{name:`Tues`,weekdayKey:`weekday.tue`,range:[95,98],avg:97,max:98,min:95},{name:`Wed`,weekdayKey:`weekday.wed`,range:[96,99],avg:98,max:99,min:96},{name:`Thu`,weekdayKey:`weekday.thu`,range:[95,98],avg:97,max:98,min:95},{name:`Fri`,weekdayKey:`weekday.fri`,range:[96,99],avg:97,max:99,min:96},{name:`Sat`,weekdayKey:`weekday.sat`,range:[97,99],avg:98,max:99,min:97},{name:`Sun`,weekdayKey:`weekday.sun`,range:[96,98],avg:97,max:98,min:96}],[]),M=(0,S.useMemo)(()=>{var t,n;return(t=e==null||(n=e.chartData)==null?void 0:n.map((e,t)=>({name:[`Mon`,`Tues`,`Wed`,`Thu`,`Fri`,`Sat`,`Sun`][t%7],weekdayKey:e.weekdayKey,range:[e.min,e.max],avg:e.avg,max:e.max,min:e.min})))==null?j:t},[e==null?void 0:e.chartData,j]),N=(0,S.useMemo)(()=>()=>{if(!e)return null;let{trend:n,changeValue:i}=e.summary;if(i===0)return null;let a=n===`up`,o=a?r:t;return(0,C.jsxs)(`span`,{className:`flex items-center gap-0.5 text-sm`,style:{color:a?m.trend.down:m.trend.up},children:[(0,C.jsx)(o,{className:`w-3 h-3`}),Math.abs(i)]})},[e,m.trend]);return(0,C.jsxs)(h,{className:`${n} relative overflow-hidden`,children:[(0,C.jsx)(`div`,{className:`absolute inset-0 rounded-2xl flex items-center justify-center z-10 transition-all duration-300 ease-in-out ${i?`opacity-100`:`opacity-0 pointer-events-none`}`,style:{backgroundColor:d.loadingOverlay},children:(0,C.jsx)(c,{className:`w-8 h-8 text-white animate-spin`})}),(0,C.jsxs)(`div`,{className:`flex items-center gap-2 mb-4`,children:[(0,C.jsx)(o,{className:`w-5 h-5`,style:{color:A}}),(0,C.jsx)(`h3`,{className:`text-base font-semibold text-slate-800`,children:k(`page.spo2.trendyReport`)})]}),(0,C.jsxs)(`div`,{className:`rounded-xl px-5 py-4 mb-4 mx-1`,style:{backgroundColor:m.background.summaryBox},children:[(0,C.jsxs)(`div`,{className:`flex items-start justify-between mb-4`,children:[(0,C.jsxs)(`div`,{children:[(0,C.jsx)(`p`,{className:`text-xs text-slate-500 mb-1`,children:k(`page.spo2.weeksAverage`)}),(0,C.jsxs)(`div`,{className:`flex items-baseline gap-1.5`,children:[(0,C.jsx)(`span`,{className:`text-3xl font-bold`,style:{color:A},children:(a=e==null||(s=e.summary)==null?void 0:s.avgValue)==null?`--`:a}),(0,C.jsx)(`span`,{className:`text-lg text-slate-500`,children:`%`}),N()]}),(0,C.jsxs)(`p`,{className:`text-xs text-slate-400 mt-0.5`,children:[k(`time.lastWeek`),`: `,(l=e==null||(p=e.summary)==null?void 0:p.previousAvg)==null?`--`:l,`%`]})]}),(0,C.jsx)(`div`,{className:`text-right text-xs text-slate-400 px-3 py-1.5 rounded-lg bg-white/60`,children:(0,C.jsxs)(`p`,{children:[k(`page.spo2.normalRange`),`: 95% - 100%`]})})]}),(0,C.jsxs)(`div`,{className:`flex gap-6`,children:[(0,C.jsxs)(`div`,{children:[(0,C.jsxs)(`span`,{className:`text-xs text-slate-400`,children:[k(`common.max`),`(`,e?k(e.summary.maxWeekdayKey):`--`,`)`]}),(0,C.jsxs)(`p`,{className:`text-xl font-semibold`,style:{color:A},children:[(g=e==null||(v=e.summary)==null?void 0:v.maxValue)==null?`--`:g,` `,(0,C.jsx)(`span`,{className:`text-sm font-normal`,children:`%`})]})]}),(0,C.jsxs)(`div`,{children:[(0,C.jsxs)(`span`,{className:`text-xs text-slate-400`,children:[k(`common.min`),`(`,e?k(e.summary.minWeekdayKey):`--`,`)`]}),(0,C.jsxs)(`p`,{className:`text-xl font-semibold text-slate-600`,children:[(y=e==null||(b=e.summary)==null?void 0:b.minValue)==null?`--`:y,` `,(0,C.jsx)(`span`,{className:`text-sm font-normal`,children:`%`})]})]})]})]}),(0,C.jsx)(_,{data:M,lines:[{dataKey:`avg`,areaDataKey:`range`,color:A,label:k(`page.spo2.mean`),showArea:!0,gradientId:`spo2RangeGradient`,legendShape:`line`}],xAxisKey:`name`,yAxisDomain:[(x=e==null||(T=e.yAxisRange)==null?void 0:T.min)==null?90:x,(E=e==null||(D=e.yAxisRange)==null?void 0:D.max)==null?100:E],renderTooltip:e=>(0,C.jsx)(w,{...e}),referenceLine:{value:(O=e==null?void 0:e.averageLine)==null?97:O,color:A},height:224})]})}var E=[`normal`,`low`,`too_low`],D={normal:`status.normal`,low:`status.low`,too_low:`status.tooLow`};function O({data:e,className:t,isLoading:r}){var i,a,o,s;let{t:c}=u(),l=f.spo2,d=(i=e==null||(a=e.summary)==null?void 0:a.distribution)==null?[]:i,m=(o=e==null||(s=e.summary)==null?void 0:s.totalCount)==null?0:o,h=E.map(e=>{let t=d.find(t=>t.type===e);return{type:e,label:c(D[e]||`status.${e}`),count:(t==null?void 0:t.count)||0,percent:(t==null?void 0:t.percent)||0,color:p.spo2[e]||`#94A3B8`}});return(0,C.jsx)(g,{title:c(`page.spo2.statistics`),icon:n,themeColor:l,donutThickness:12,pieChartSize:`small`,items:h,centerValue:m,centerLabel:c(`common.times`),showCount:!0,columns:1,className:t,isLoading:r})}function k({data:t,className:n,isLoading:r}){var i,a,o,s,c,l,d,p;let{t:m}=u(),h=f.spo2,g=(i=t==null||(a=t.weeklySummary)==null?void 0:a.dataAnalysis)==null?[]:i,_=[m(`page.spo2.defaultAnalysis1`,{avg:(o=t==null||(s=t.summary)==null?void 0:s.avgValue)==null?`--`:o}),m(`page.spo2.defaultAnalysis2`,{max:(c=t==null||(l=t.summary)==null?void 0:l.maxValue)==null?`--`:c,maxDay:t?m(t.summary.maxWeekdayKey):`--`}),m(`page.spo2.defaultAnalysis3`,{min:(d=t==null||(p=t.summary)==null?void 0:p.minValue)==null?`--`:d,minDay:t?m(t.summary.minWeekdayKey):`--`})];return(0,C.jsx)(x,{titleKey:`page.spo2.dataAnalysis`,Icon:e,items:(g.length>0?g:_).map(e=>typeof e==`string`?e:e.content),themeColor:h,className:n,isLoading:r})}function A({data:e,className:t,isLoading:n}){let{t:r}=u(),i=f.spo2,o=e==null?void 0:e.weeklySummary;return(0,C.jsx)(v,{titleKey:`page.spo2.weeklyOverview`,Icon:a,overallText:(o==null?void 0:o.overview)||r(`page.spo2.defaultOverview`,{defaultValue:`Your blood pressure is generally within the ideal range. Although your systolic blood pressure has risen slightly compared to last week, it remains within the normal fluctuation range.`}),highlightText:(o==null?void 0:o.highlights)||r(`page.spo2.defaultHighlights`,{defaultValue:`The trend chart shows that your blood pressure rose significantly during the week (Wednesday and Thursday), with a peak systolic pressure approaching 150 mmHg. Meanwhile, the statistics show that your blood pressure measurements fluctuated considerably across different levels. We will continue to monitor your condition and help you identify any possible causes for the elevated blood pressure.`}),highlightLabelKey:`page.spo2.anomalyAlert`,highlightColor:`#FBBF24`,suggestions:o==null?void 0:o.suggestions,themeColor:i,className:t,isLoading:n})}var j={周一:`weekdays.mon`,周二:`weekdays.tue`,周三:`weekdays.wed`,周四:`weekdays.thu`,周五:`weekdays.fri`,周六:`weekdays.sat`,周日:`weekdays.sun`};function M(e){let t=new Date(e);return`${String(t.getMonth()+1).padStart(2,`0`)}/${String(t.getDate()).padStart(2,`0`)}`}function N(e){return e>=95?`normal`:e>=90?`low`:`too_low`}function P(e){return e===`up`||e===`down`||e===`stable`?e:`stable`}function F(e){return e&&j[e]||`weekdays.mon`}function I(e){var t,n,r,i,a,o,s,c,l,u,d,f,p,m,h;console.log(`[SpO2 Adapter] Input:`,e);let g=((e==null||(t=e.trend_chart)==null?void 0:t.chart_data)||[]).map(e=>{var t;let n=new Date(e.date),r=(t=e.avg)==null?Math.round((e.max+e.min)/2):t;return{date:n,dateLabel:M(e.date),weekdayKey:j[e.label]||`weekdays.mon`,max:e.max||0,min:e.min||0,avg:r,range:[e.min||0,e.max||0]}}),_=(e==null||(n=e.overview)==null?void 0:n.average)||0,v=(e==null||(r=e.overview)==null?void 0:r.min)||0,y=(e==null||(i=e.overview)==null?void 0:i.max)||0,b=F(e==null||(a=e.overview)==null?void 0:a.max_label),x=F(e==null||(o=e.overview)==null?void 0:o.min_label),S=N(_),C=(e==null?void 0:e.comparison)||{},w=C.changes||{},T=P((s=w.average)==null?void 0:s.trend),E=((c=w.average)==null?void 0:c.value)||0,D=((l=C.previous)==null?void 0:l.average)||0,O=g.length>0?{avg:g[g.length-1].avg,min:g[g.length-1].min,max:g[g.length-1].max,date:g[g.length-1].date}:null,k=(e==null?void 0:e.weekly_summary)||{},A={overview:k.overview||null,highlights:k.highlights||null,suggestions:k.suggestions||[],dataAnalysis:(k.data_analysis||[]).map(e=>({content:e}))},I={chartData:g,yAxisRange:(e==null||(u=e.trend_chart)==null?void 0:u.y_axis_range)||{min:85,max:100},averageLine:(e==null||(d=e.trend_chart)==null?void 0:d.average_line)||_,summary:{avgValue:_,minValue:v,maxValue:y,maxWeekdayKey:b,minWeekdayKey:x,status:S,statusKey:`status.${S}`,trend:T,changeValue:E,totalCount:(e==null||(f=e.statistics)==null?void 0:f.total_count)||0,distribution:(e==null||(p=e.statistics)==null?void 0:p.distribution)||[],previousAvg:D},comparison:{current:{average:((m=C.current)==null?void 0:m.average)||_},previous:{average:((h=C.previous)==null?void 0:h.average)||0},insight:C.insight||null},weeklySummary:A,latestReading:O};return console.log(`[SpO2 Adapter] Output:`,I),I}const L={all:[`spo2`],trend:e=>[...L.all,`trend`,e==null?void 0:e.startDate,e==null?void 0:e.endDate],details:()=>[...L.all,`details`]};function R(e){return l({queryKey:L.trend(e),queryFn:async()=>{console.log(`[SpO2 API] Fetching with dateRange:`,e);let t=await y(e?{start_date:e.startDate,end_date:e.endDate}:void 0);return console.log(`[SpO2 API] Result:`,t),t},select:e=>I(e),staleTime:300*1e3,gcTime:600*1e3})}function z(){return b({featureName:`SpO2`,queryKeyFn:L.trend,fetchFn:e=>y({start_date:e.startDate,end_date:e.endDate})})}export{O as a,k as i,R as n,T as o,A as r,z as t};