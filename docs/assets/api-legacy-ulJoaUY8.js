System.register(["./vendor-legacy-BFWz_Ol4.js","./vendor-query-legacy-DmLb6WcG.js","./vendor-i18n-legacy-fjOwBjkb.js","./theme-legacy-BPmhlnTm.js","./card-legacy-BAqfJ-x3.js","./DistributionCard-legacy-D0GcXimJ.js","./TrendLineChart-legacy-OymNiGz5.js","./WeeklyOverviewCard-legacy-BA9KKe86.js","./usePrefetchData-legacy-IN3Mv77r.js"],function(e,a){var l,t,s,n,i,o,r,d,u,m,c,g,x,v,h,y,p,f,j,w,b,N,k,L,K,_,F,A,M,D;function V(e){const a=new Date(e);return`${String(a.getMonth()+1).padStart(2,"0")}/${String(a.getDate()).padStart(2,"0")}`}return e({a:function({data:e,className:a,isLoading:l}){var t,n,i,o;const{t:r}=c(),d=x.glucose,u=null!==(t=null==e||null===(n=e.summary)||void 0===n?void 0:n.distribution)&&void 0!==t?t:[],m=null!==(i=null==e||null===(o=e.summary)||void 0===o?void 0:o.totalCount)&&void 0!==i?i:0,g=(0,N.useMemo)(()=>_.map(e=>{const a=u.find(a=>a.type===e);return{type:e,label:r(F[e]||`status.${e}`),count:(null==a?void 0:a.count)||0,percent:(null==a?void 0:a.percent)||0,color:v.glucose[e]||"#94A3B8"}}),[u,r]),h=(0,N.useMemo)(()=>g.filter(e=>"normal"===e.type).reduce((e,a)=>e+(a.count||0),0),[g]);return(0,k.jsx)(p,{title:r("page.glucose.statistics"),icon:s,themeColor:d,items:g,pieChartSize:"medium",centerValue:r("common.good"),centerLabel:r("common.inAverage"),highlightValue:h,highlightLabel:`/ ${m} ${r("common.times")}`,highlightDescription:r("page.glucose.normalResults"),gridColumns:2,className:a,isLoading:l})},i:function({data:e,className:a,isLoading:s}){var i,o;const{t:r}=c(),d=x.glucose,m=null!==(i=null==e?void 0:e.comparison)&&void 0!==i?i:{current:{average:0},previous:{average:0},insight:null},v=null!==(o=null==e?void 0:e.summary)&&void 0!==o?o:{changeValue:0,trend:"stable",previousAvg:0,avgFasting:null,avgPostMeal:null},h=m.insight||r("page.glucose.defaultInsight",{defaultValue:"Your blood glucose is generally within the normal range. Keep maintaining a balanced diet and regular exercise habits for stable blood sugar levels."});return(0,k.jsxs)(y,{className:`${a} relative overflow-hidden`,children:[(0,k.jsx)("div",{className:"absolute inset-0 rounded-2xl flex items-center justify-center z-10 transition-all duration-300 ease-in-out "+(s?"opacity-100":"opacity-0 pointer-events-none"),style:{backgroundColor:g.loadingOverlay},children:(0,k.jsx)(u,{className:"w-8 h-8 text-white animate-spin"})}),(0,k.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,k.jsx)(l,{className:"w-5 h-5",style:{color:d}}),(0,k.jsx)("h3",{className:"text-base font-semibold text-slate-800",children:r("page.glucose.compareWithLastWeek")})]}),(0,k.jsxs)("div",{className:"flex gap-3 mb-4",children:[(0,k.jsxs)("div",{className:"flex-1 p-3 rounded-xl bg-slate-50",children:[(0,k.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:r("page.glucose.averageGlucose")}),(0,k.jsxs)("div",{className:"flex items-center gap-2",children:[(0,k.jsx)("span",{className:"text-xl font-bold",style:{color:d},children:e?m.current.average.toFixed(1):"--"}),(0,k.jsx)("span",{className:"text-sm text-slate-400",children:r("units.mmolL")}),0!==v.changeValue&&(0,k.jsxs)("div",{className:"flex items-center gap-0.5 text-sm font-medium",style:{color:(p=v.trend,"up"===p?"#EF4444":"down"===p?"#10B981":d)},children:[(e=>"up"===e?(0,k.jsx)(n,{className:"w-4 h-4"}):"down"===e?(0,k.jsx)(t,{className:"w-4 h-4"}):null)(v.trend),Math.abs(v.changeValue).toFixed(1)]})]}),(0,k.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:[r("time.lastWeek"),": ",e?e.summary.previousAvg.toFixed(1):"--",r("units.mmolL")]})]}),v.avgFasting&&(0,k.jsxs)("div",{className:"flex-1 p-3 rounded-xl bg-slate-50",children:[(0,k.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:r("page.glucose.fastingLevel")}),(0,k.jsxs)("div",{className:"flex items-center gap-2",children:[(0,k.jsx)("span",{className:"text-xl font-bold",style:{color:d},children:v.avgFasting.toFixed(1)}),(0,k.jsx)("span",{className:"text-sm text-slate-400",children:r("units.mmolL")})]}),(0,k.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:[r("page.glucose.fastingNormal"),": 3.9-6.1"]})]}),!v.avgFasting&&v.avgPostMeal&&(0,k.jsxs)("div",{className:"flex-1 p-3 rounded-xl bg-slate-50",children:[(0,k.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:r("page.glucose.postMealLevel")}),(0,k.jsxs)("div",{className:"flex items-center gap-2",children:[(0,k.jsx)("span",{className:"text-xl font-bold",style:{color:d},children:v.avgPostMeal.toFixed(1)}),(0,k.jsx)("span",{className:"text-sm text-slate-400",children:r("units.mmolL")})]}),(0,k.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:[r("page.glucose.postMealNormal"),": <7.8"]})]})]}),(0,k.jsx)("div",{className:"p-4 rounded-2xl bg-amber-50",children:(0,k.jsx)("p",{className:"text-sm text-slate-700 leading-relaxed",children:h})})]});var p},n:function(){return b({featureName:"Glucose",queryKeyFn:D.trend,fetchFn:e=>w({start_date:e.startDate,end_date:e.endDate})})},r:function({data:e,className:a,isLoading:l}){const{t:t}=c(),s=x.glucose,n=null==e?void 0:e.weeklySummary;return(0,k.jsx)(j,{titleKey:"page.glucose.weeklyOverview",Icon:o,overallText:(null==n?void 0:n.overview)||t("page.glucose.defaultOverview",{defaultValue:"Your blood glucose levels are generally within the normal range this week. Keep up the good work with your diet and exercise habits!"}),highlightText:(null==n?void 0:n.highlights)||t("page.glucose.defaultHighlights",{defaultValue:"The trend chart shows some fluctuations in your blood glucose levels during the week. Pay attention to your diet, especially after meals, to maintain stable blood sugar levels."}),highlightLabelKey:"page.glucose.needsAttention",highlightColor:"#FBBF24",suggestions:null==n?void 0:n.suggestions,themeColor:s,className:a,isLoading:l})},t:function(e){return m({queryKey:D.trend(e),queryFn:async()=>{console.log("[Glucose API] Fetching with dateRange:",e);const a=await w(e?{start_date:e.startDate,end_date:e.endDate}:void 0);return console.log("[Glucose API] Result:",a),a},select:e=>function(e){var a,l,t,s,n,i,o,r,d,u,m,c;console.log("[Glucose Adapter] Input:",e);const g=((null==e||null===(a=e.trend_chart)||void 0===a?void 0:a.chart_data)||[]).map(e=>{var a,l,t,s;const n=new Date(e.date),i=null!==(a=null!==(l=e.max)&&void 0!==l?l:e.value)&&void 0!==a?a:0,o=null!==(t=null!==(s=e.min)&&void 0!==s?s:e.value)&&void 0!==t?t:0;return{date:n,dateLabel:V(e.date),weekdayKey:A[e.label]||"weekdays.mon",max:i,min:o,avg:(i+o)/2,typeKey:e.type?M[e.type]:void 0}}),x=(null==e?void 0:e.overview)||{},v=x.average||0,h=null!==(l=x.max)&&void 0!==l?l:g.length>0?Math.max(...g.map(e=>e.max)):0,y=null!==(t=x.min)&&void 0!==t?t:g.length>0?Math.min(...g.map(e=>e.min)):0,p=x.max_label&&A[x.max_label]||"weekdays.mon",f=x.min_label&&A[x.min_label]||"weekdays.mon",j=x.fasting_avg,w=x.post_meal_avg,b=(N=j||v)<3.9?"low":N<=6.1?"normal":N<=7?"elevated":"high";var N;const k=(null==e?void 0:e.comparison)||{},L=k.changes||{},K=function(e){return"up"===e||"down"===e||"stable"===e?e:"stable"}(null===(s=L.average)||void 0===s?void 0:s.trend),_=(null===(n=L.average)||void 0===n?void 0:n.value)||0,F=(null===(i=k.previous)||void 0===i?void 0:i.average)||0,D=g.length>0?{value:g[g.length-1].avg,typeKey:g[g.length-1].typeKey,date:g[g.length-1].date}:null,C=(null==e?void 0:e.normal_range)||(null==e||null===(o=e.trend_chart)||void 0===o?void 0:o.normal_range)||{min:3.9,max:6.1},R=(null==e?void 0:e.weekly_summary)||{},S={chartData:g,yAxisRange:(null==e||null===(r=e.trend_chart)||void 0===r?void 0:r.y_axis_range)||{min:2,max:9},averageLine:(null==e||null===(d=e.trend_chart)||void 0===d?void 0:d.average_line)||v,normalRange:C,summary:{avgValue:v,minValue:y,maxValue:h,minWeekdayKey:f,maxWeekdayKey:p,previousAvg:F,avgFasting:j,avgPostMeal:w,status:b,statusKey:`status.${b}`,trend:K,changeValue:_,totalCount:(null==e||null===(u=e.statistics)||void 0===u?void 0:u.total_count)||0,distribution:(null==e||null===(m=e.statistics)||void 0===m?void 0:m.distribution)||[]},comparison:{current:{average:(null===(c=k.current)||void 0===c?void 0:c.average)||v},previous:{average:F},insight:k.insight||null},weeklySummary:{overview:R.overview||null,highlights:R.highlights||null,suggestions:R.suggestions||[],dataAnalysis:R.data_analysis||[]},latestReading:D};return console.log("[Glucose Adapter] Output:",S),S}(e),staleTime:3e5,gcTime:6e5})}}),{setters:[function(e){l=e.C,t=e.E,s=e.O,n=e.T,i=e.at,o=e.h,r=e.r,d=e.rt,u=e.u},function(e){m=e.t},function(e){c=e.n},function(e){g=e.c,x=e.l,v=e.o,h=e.s},function(e){y=e.t},function(e){p=e.t},function(e){f=e.t},function(e){j=e.t},function(e){w=e.r,b=e.t}],execute:function(){N=i(),k=d(),L=(0,N.memo)(({active:e,payload:a})=>{var l;const{t:t}=c();if(!e||!a||0===a.length)return null;const s=null===(l=a[0])||void 0===l?void 0:l.payload;return s?(0,k.jsxs)("div",{className:"bg-slate-700 text-white px-3 py-2 rounded-lg text-sm shadow-lg",children:[(0,k.jsx)("p",{className:"font-medium mb-1",children:t(s.weekdayKey)}),(0,k.jsxs)("p",{className:"text-amber-300",children:[t("common.max"),": ",s.max," ",t("units.mmolL")]}),(0,k.jsxs)("p",{className:"text-amber-200",children:[t("common.min"),": ",s.min," ",t("units.mmolL")]})]}):null}),K=({data:e,className:a,isLoading:l})=>{var s,i,o,d,m,v,p,j,w,b,K,_,F,A,M,D,V;const{t:C}=c(),R=x.glucose,S=(0,N.useMemo)(()=>[{name:"Mon",weekdayKey:"weekday.mon",range:[4.5,6.5],avg:5.5,max:6.5,min:4.5},{name:"Tues",weekdayKey:"weekday.tue",range:[4.8,7],avg:5.8,max:7,min:4.8},{name:"Wed",weekdayKey:"weekday.wed",range:[4.6,6.8],avg:5.6,max:6.8,min:4.6},{name:"Thu",weekdayKey:"weekday.thu",range:[4.4,6.4],avg:5.4,max:6.4,min:4.4},{name:"Fri",weekdayKey:"weekday.fri",range:[4.7,6.9],avg:5.7,max:6.9,min:4.7},{name:"Sat",weekdayKey:"weekday.sat",range:[4.5,6.6],avg:5.5,max:6.6,min:4.5},{name:"Sun",weekdayKey:"weekday.sun",range:[4.6,6.7],avg:5.6,max:6.7,min:4.6}],[]),T=(0,N.useMemo)(()=>{var a,l;return null!==(a=null==e||null===(l=e.chartData)||void 0===l?void 0:l.map((e,a)=>({name:["Mon","Tues","Wed","Thu","Fri","Sat","Sun"][a%7],weekdayKey:e.weekdayKey,range:[e.min,e.max],avg:e.avg,max:e.max,min:e.min})))&&void 0!==a?a:S},[null==e?void 0:e.chartData,S]);return(0,k.jsxs)(y,{className:`${a} relative overflow-hidden`,children:[(0,k.jsx)("div",{className:"absolute inset-0 rounded-2xl flex items-center justify-center z-10 transition-all duration-300 ease-in-out "+(l?"opacity-100":"opacity-0 pointer-events-none"),style:{backgroundColor:g.loadingOverlay},children:(0,k.jsx)(u,{className:"w-8 h-8 text-white animate-spin"})}),(0,k.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,k.jsx)(r,{className:"w-5 h-5",style:{color:R}}),(0,k.jsx)("h3",{className:"text-base font-semibold text-slate-800",children:C("page.glucose.trendyReport")})]}),(0,k.jsxs)("div",{className:"rounded-xl px-5 py-4 mb-4 mx-1",style:{backgroundColor:h.background.warning},children:[(0,k.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:C("page.glucose.weeksAverage")}),(0,k.jsxs)("div",{className:"flex items-baseline gap-1.5",children:[(0,k.jsx)("span",{className:"text-3xl font-bold",style:{color:R},children:null!==(s=null==e||null===(i=e.summary)||void 0===i||null===(i=i.avgValue)||void 0===i?void 0:i.toFixed(1))&&void 0!==s?s:"--"}),(0,k.jsx)("span",{className:"text-lg text-slate-500",children:C("units.mmolL")}),(()=>{if(!e)return null;const{trend:a,changeValue:l}=e.summary;if(0===l)return null;const s="up"===a;return(0,k.jsxs)("span",{className:"flex items-center gap-0.5 text-sm",style:{color:s?"#EF4444":"#10B981"},children:[(0,k.jsx)(s?n:t,{className:"w-3 h-3"}),Math.abs(l).toFixed(1)]})})()]}),(0,k.jsxs)("p",{className:"text-xs text-slate-400 mt-0.5",children:[C("time.lastWeek"),": ",null!==(o=null==e||null===(d=e.summary)||void 0===d||null===(d=d.previousAvg)||void 0===d?void 0:d.toFixed(1))&&void 0!==o?o:"--"," ",C("units.mmolL")]})]}),(0,k.jsx)("div",{className:"text-right text-xs text-slate-400 px-3 py-1.5 rounded-lg bg-white/60",children:(0,k.jsxs)("p",{children:[C("page.glucose.normalRange"),": ",null!==(m=null==e||null===(v=e.normalRange)||void 0===v?void 0:v.min)&&void 0!==m?m:3.9,"-",null!==(p=null==e||null===(j=e.normalRange)||void 0===j?void 0:j.max)&&void 0!==p?p:6.1," ",C("units.mmolL")]})})]}),(0,k.jsxs)("div",{className:"flex gap-6",children:[(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{className:"text-xs text-slate-400",children:[C("common.max"),"(",e?C(e.summary.maxWeekdayKey):"--",")"]}),(0,k.jsxs)("p",{className:"text-xl font-semibold",style:{color:R},children:[null!==(w=null==e||null===(b=e.summary)||void 0===b||null===(b=b.maxValue)||void 0===b?void 0:b.toFixed(1))&&void 0!==w?w:"--"," ",(0,k.jsx)("span",{className:"text-sm font-normal",children:C("units.mmolL")})]})]}),(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{className:"text-xs text-slate-400",children:[C("common.min"),"(",e?C(e.summary.minWeekdayKey):"--",")"]}),(0,k.jsxs)("p",{className:"text-xl font-semibold text-slate-600",children:[null!==(K=null==e||null===(_=e.summary)||void 0===_||null===(_=_.minValue)||void 0===_?void 0:_.toFixed(1))&&void 0!==K?K:"--"," ",(0,k.jsx)("span",{className:"text-sm font-normal",children:C("units.mmolL")})]})]})]})]}),(0,k.jsx)(f,{data:T,lines:[{dataKey:"avg",areaDataKey:"range",color:R,label:C("page.glucose.mean"),showArea:!0,gradientId:"glucoseRangeGradient",legendShape:"line"}],xAxisKey:"name",yAxisDomain:[null!==(F=null==e||null===(A=e.yAxisRange)||void 0===A?void 0:A.min)&&void 0!==F?F:3,null!==(M=null==e||null===(D=e.yAxisRange)||void 0===D?void 0:D.max)&&void 0!==M?M:10],renderTooltip:e=>(0,k.jsx)(L,{...e}),referenceLine:{value:null!==(V=null==e?void 0:e.averageLine)&&void 0!==V?V:5.5,color:R},height:224,chartMargin:{top:10,right:10,left:-15,bottom:0}})]})},e("o",(0,N.memo)(K)),_=["normal","high","too_high","too_low"],F={normal:"status.normal",high:"status.high",too_high:"status.tooHigh",too_low:"status.tooLow"},A={"周一":"weekdays.mon","周二":"weekdays.tue","周三":"weekdays.wed","周四":"weekdays.thu","周五":"weekdays.fri","周六":"weekdays.sat","周日":"weekdays.sun"},M={"空腹":"vitals.fasting","餐后":"vitals.postMeal","随机":"common.value"},D={all:["glucose"],trend:e=>[...D.all,"trend",null==e?void 0:e.startDate,null==e?void 0:e.endDate],details:()=>[...D.all,"details"]}}}});