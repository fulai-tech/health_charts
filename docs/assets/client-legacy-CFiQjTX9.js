System.register(["./vendor-legacy-BFWz_Ol4.js"],function(e,t){var a,r,s,o,n;return{setters:[function(e){a=e.t}],execute:function(){e("n",r={baseURL:"https://test.fulai.tech",auth:{deviceLogin:"/auth/app/login"},trendReview:{overview:"/trend-review/overview",indicatorDetail:"/trend-review/indicator-detail"},currentStatus:{dimensionDetail:"/current-status/dimension-detail"},device:{username:"fulai001",password:"123456"}}),s={accessToken:6048e5,refreshToken:2592e6},o="fulai_auth_data",n=new class{constructor(){this.authData=null,this.loadFromStorage()}loadFromStorage(){try{const e=localStorage.getItem(o);e&&(this.authData=JSON.parse(e))}catch(e){console.error("Failed to load auth data from storage:",e),this.authData=null}}saveToStorage(){try{this.authData?localStorage.setItem(o,JSON.stringify(this.authData)):localStorage.removeItem(o)}catch(e){console.error("Failed to save auth data to storage:",e)}}async login(e){const t=e||{username:r.device.username,password:r.device.password},o=await a.post(`${r.baseURL}${r.auth.deviceLogin}`,t,{headers:{"Content-Type":"application/json",Accept:"application/json"}});if(0!==o.data.code)throw new Error(o.data.msg||"Login failed");const n=Date.now();return this.authData={user:o.data.data.user,accessToken:o.data.data.accessToken,refreshToken:o.data.data.refreshToken,accessTokenExpiry:n+s.accessToken,refreshTokenExpiry:n+s.refreshToken},this.saveToStorage(),this.authData}isAuthenticated(){return!!this.authData&&Date.now()<this.authData.accessTokenExpiry-3e5}canRefresh(){return!!this.authData&&Date.now()<this.authData.refreshTokenExpiry}getAccessToken(){return this.authData?this.authData.accessToken:null}getRefreshToken(){return this.authData?this.authData.refreshToken:null}getAuthData(){return this.authData}logout(){this.authData=null,this.saveToStorage()}async ensureAuthenticated(){return this.isAuthenticated()||await this.login(),this.authData.accessToken}},e("t",function(){const e=a.create({baseURL:r.baseURL,headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:3e4});return e.interceptors.request.use(async e=>{var t;try{const t=await n.ensureAuthenticated();t&&(e.headers.Authorization=`Bearer ${t}`)}catch(a){console.error("Failed to get auth token:",a)}return console.log("[API Request]",null===(t=e.method)||void 0===t?void 0:t.toUpperCase(),e.url,e.data),e},e=>Promise.reject(e)),e.interceptors.response.use(e=>e,async t=>{var a;const r=t.config;if(401===(null===(a=t.response)||void 0===a?void 0:a.status)&&!r._retry){r._retry=!0;try{n.logout();const t=await n.ensureAuthenticated();return r.headers.Authorization=`Bearer ${t}`,e(r)}catch(s){return Promise.reject(s)}}return Promise.reject(t)}),e}())}}});