import{t as e}from"./vendor-DxyDeVV0.js";const t={baseURL:`https://test.fulai.tech`,auth:{deviceLogin:`/auth/app/login`},trendReview:{overview:`/trend-review/overview`,indicatorDetail:`/trend-review/indicator-detail`},currentStatus:{dimensionDetail:`/current-status/dimension-detail`},device:{username:`fulai001`,password:`123456`}},n={accessToken:10080*60*1e3,refreshToken:720*60*60*1e3},r=`fulai_auth_data`,i=new class{constructor(){this.authData=null,this.loadFromStorage()}loadFromStorage(){try{let e=localStorage.getItem(r);e&&(this.authData=JSON.parse(e))}catch(e){console.error(`Failed to load auth data from storage:`,e),this.authData=null}}saveToStorage(){try{this.authData?localStorage.setItem(r,JSON.stringify(this.authData)):localStorage.removeItem(r)}catch(e){console.error(`Failed to save auth data to storage:`,e)}}async login(r){let i=r||{username:t.device.username,password:t.device.password},a=await e.post(`${t.baseURL}${t.auth.deviceLogin}`,i,{headers:{"Content-Type":`application/json`,Accept:`application/json`}});if(a.data.code!==0)throw Error(a.data.msg||`Login failed`);let o=Date.now();return this.authData={user:a.data.data.user,accessToken:a.data.data.accessToken,refreshToken:a.data.data.refreshToken,accessTokenExpiry:o+n.accessToken,refreshTokenExpiry:o+n.refreshToken},this.saveToStorage(),this.authData}isAuthenticated(){return this.authData?Date.now()<this.authData.accessTokenExpiry-300*1e3:!1}canRefresh(){return this.authData?Date.now()<this.authData.refreshTokenExpiry:!1}getAccessToken(){return this.authData?this.authData.accessToken:null}getRefreshToken(){return this.authData?this.authData.refreshToken:null}getAuthData(){return this.authData}logout(){this.authData=null,this.saveToStorage()}async ensureAuthenticated(){return this.isAuthenticated()||await this.login(),this.authData.accessToken}};function a(){let n=e.create({baseURL:t.baseURL,headers:{"Content-Type":`application/json`,Accept:`application/json`},timeout:3e4});return n.interceptors.request.use(async e=>{var t;try{let t=await i.ensureAuthenticated();t&&(e.headers.Authorization=`Bearer ${t}`)}catch(e){console.error(`Failed to get auth token:`,e)}return console.log(`[API Request]`,(t=e.method)==null?void 0:t.toUpperCase(),e.url,e.data),e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if(((t=e.response)==null?void 0:t.status)===401&&!r._retry){r._retry=!0;try{i.logout();let e=await i.ensureAuthenticated();return r.headers.Authorization=`Bearer ${e}`,n(r)}catch(e){return Promise.reject(e)}}return Promise.reject(e)}),n}const o=a();export{t as n,o as t};