import{C as e,E as t,O as n,T as r,at as i,h as a,r as o,rt as s,u as c}from"./vendor-DxyDeVV0.js";import{t as l}from"./vendor-query-BzUZE9-d.js";import{n as u}from"./vendor-i18n-BSzAmJZ7.js";import{c as d,l as f,o as p,s as m}from"./theme-XEO8amRP.js";import{t as h}from"./card-DR_iUne-.js";import{t as g}from"./DistributionCard-D_3pQ4Tr.js";import{t as _}from"./TrendLineChart-B7CWIoTy.js";import{t as v}from"./WeeklyOverviewCard-DICJkH00.js";import{i as y,t as b}from"./usePrefetchData-Dtc8Q6b7.js";import{t as x}from"./DataAnalysisCard-C8_RImdq.js";var S=i(),C=s(),w=(0,S.memo)(({active:e,payload:t})=>{var n;let{t:r}=u();if(!e||!t||t.length===0)return null;let i=(n=t[0])==null?void 0:n.payload;return i?(0,C.jsxs)(`div`,{className:`bg-slate-700 text-white px-3 py-2 rounded-lg text-sm shadow-lg`,children:[(0,C.jsx)(`p`,{className:`font-medium mb-1`,children:r(i.weekdayKey)}),(0,C.jsxs)(`p`,{className:`text-red-300`,children:[r(`common.average`),`: `,i.avg]}),(0,C.jsxs)(`p`,{className:`text-red-200`,children:[r(`common.max`),`: `,i.max]}),(0,C.jsxs)(`p`,{className:`text-red-100`,children:[r(`common.min`),`: `,i.min]})]}):null});const T=(0,S.memo)(({data:e,className:n,isLoading:i})=>{var a,s,l,p,g,v,y,b,x,T,E,D,O;let{t:k}=u(),A=f.heartRate,j=(0,S.useMemo)(()=>[{name:`Mon`,weekdayKey:`weekday.mon`,range:[60,85],avg:72,max:85,min:60},{name:`Tues`,weekdayKey:`weekday.tue`,range:[62,88],avg:75,max:88,min:62},{name:`Wed`,weekdayKey:`weekday.wed`,range:[58,82],avg:70,max:82,min:58},{name:`Thu`,weekdayKey:`weekday.thu`,range:[65,90],avg:78,max:90,min:65},{name:`Fri`,weekdayKey:`weekday.fri`,range:[60,84],avg:72,max:84,min:60},{name:`Sat`,weekdayKey:`weekday.sat`,range:[55,80],avg:68,max:80,min:55},{name:`Sun`,weekdayKey:`weekday.sun`,range:[58,83],avg:70,max:83,min:58}],[]),M=(0,S.useMemo)(()=>{var t,n;return(t=e==null||(n=e.chartData)==null?void 0:n.map((e,t)=>({name:[`Mon`,`Tues`,`Wed`,`Thu`,`Fri`,`Sat`,`Sun`][t%7],weekdayKey:e.weekdayKey,range:[e.min,e.max],avg:e.avg,max:e.max,min:e.min})))==null?j:t},[e==null?void 0:e.chartData,j]);return(0,C.jsxs)(h,{className:`${n} relative overflow-hidden`,children:[(0,C.jsx)(`div`,{className:`absolute inset-0 rounded-2xl flex items-center justify-center z-10 transition-all duration-300 ease-in-out ${i?`opacity-100`:`opacity-0 pointer-events-none`}`,style:{backgroundColor:d.loadingOverlay},children:(0,C.jsx)(c,{className:`w-8 h-8 text-white animate-spin`})}),(0,C.jsxs)(`div`,{className:`flex items-center gap-2 mb-4`,children:[(0,C.jsx)(o,{className:`w-5 h-5`,style:{color:A}}),(0,C.jsx)(`h3`,{className:`text-base font-semibold text-slate-800`,children:k(`page.heartRate.trendyReport`)})]}),(0,C.jsxs)(`div`,{className:`rounded-xl px-5 py-4 mb-4 mx-1`,style:{backgroundColor:m.background.summaryBox},children:[(0,C.jsx)(`div`,{className:`flex items-start justify-between mb-4`,children:(0,C.jsxs)(`div`,{children:[(0,C.jsx)(`p`,{className:`text-xs text-slate-500 mb-1`,children:k(`page.heartRate.weeksAverage`)}),(0,C.jsxs)(`div`,{className:`flex items-baseline gap-1.5`,children:[(0,C.jsx)(`span`,{className:`text-3xl font-bold`,style:{color:A},children:(a=e==null||(s=e.summary)==null?void 0:s.avgValue)==null?`--`:a}),(0,C.jsxs)(`span`,{className:`text-lg text-slate-500`,children:[`/`,k(`units.minute`)]}),(()=>{if(!e)return null;let{trend:n,changeValue:i}=e.summary;if(i===0)return null;let a=n===`up`,o=a?r:t;return(0,C.jsxs)(`span`,{className:`flex items-center gap-0.5 text-sm`,style:{color:a?m.trend.up:m.trend.down},children:[(0,C.jsx)(o,{className:`w-3 h-3`}),Math.abs(i)]})})()]}),(0,C.jsxs)(`p`,{className:`text-xs text-slate-400 mt-0.5`,children:[k(`time.lastWeek`),`: `,(l=e==null||(p=e.summary)==null?void 0:p.previousAvg)==null?`--`:l,`/`,k(`units.minute`)]})]})}),(0,C.jsxs)(`div`,{className:`flex gap-6`,children:[(0,C.jsxs)(`div`,{children:[(0,C.jsxs)(`span`,{className:`text-xs text-slate-400`,children:[k(`common.max`),`(`,e?k(e.summary.maxWeekdayKey):`--`,`)`]}),(0,C.jsxs)(`p`,{className:`text-xl font-semibold`,style:{color:A},children:[(g=e==null||(v=e.summary)==null?void 0:v.maxValue)==null?`--`:g,` `,(0,C.jsxs)(`span`,{className:`text-sm font-normal`,children:[`/`,k(`units.minute`)]})]})]}),(0,C.jsxs)(`div`,{children:[(0,C.jsxs)(`span`,{className:`text-xs text-slate-400`,children:[k(`common.min`),`(`,e?k(e.summary.minWeekdayKey):`--`,`)`]}),(0,C.jsxs)(`p`,{className:`text-xl font-semibold text-slate-600`,children:[(y=e==null||(b=e.summary)==null?void 0:b.minValue)==null?`--`:y,` `,(0,C.jsxs)(`span`,{className:`text-sm font-normal`,children:[`/`,k(`units.minute`)]})]})]})]})]}),(0,C.jsx)(_,{data:M,lines:[{dataKey:`avg`,areaDataKey:`range`,color:A,label:k(`page.heartRate.mean`),showArea:!0,gradientId:`hrRangeGradient`,legendShape:`line`}],xAxisKey:`name`,yAxisDomain:[(x=e==null||(T=e.yAxisRange)==null?void 0:T.min)==null?50:x,(E=e==null||(D=e.yAxisRange)==null?void 0:D.max)==null?120:E],renderTooltip:e=>(0,C.jsx)(w,{...e}),referenceLine:{value:(O=e==null?void 0:e.averageLine)==null?72:O,color:A},height:224})]})});var E=[`too_high`,`high`,`normal`,`slow`],D={normal:`status.normal`,high:`status.high`,too_high:`status.tooHigh`,slow:`status.slow`,low:`status.low`};function O({data:e,className:t,isLoading:r}){var i,a,o,s;let{t:c}=u(),l=f.heartRate,d=(i=e==null||(a=e.summary)==null?void 0:a.distribution)==null?[]:i,m=(o=e==null||(s=e.summary)==null?void 0:s.totalCount)==null?0:o,h=E.map(e=>{let t=d.find(t=>t.type===e);return{type:e,label:c(D[e]||`status.${e}`),count:(t==null?void 0:t.count)||0,percent:(t==null?void 0:t.percent)||0,color:p.heartRate[e]||`#94A3B8`}});return(0,C.jsx)(g,{title:c(`page.heartRate.statistics`),icon:n,themeColor:l,pieChartSize:`medium`,donutThickness:12,items:h,centerValue:m,centerLabel:c(`page.heartRate.totalTests`),showCount:!0,columns:1,className:t,isLoading:r})}function k({data:t,className:n,isLoading:r}){var i,a,o,s,c,l,d,p;let{t:m}=u(),h=f.heartRate,g=(i=t==null||(a=t.weeklySummary)==null?void 0:a.dataAnalysis)==null?[]:i,_=[m(`page.heartRate.defaultAnalysis1`,{avg:(o=t==null||(s=t.summary)==null?void 0:s.avgValue)==null?`--`:o}),m(`page.heartRate.defaultAnalysis2`,{max:(c=t==null||(l=t.summary)==null?void 0:l.maxValue)==null?`--`:c,maxDay:t?m(t.summary.maxWeekdayKey):`--`}),m(`page.heartRate.defaultAnalysis3`,{min:(d=t==null||(p=t.summary)==null?void 0:p.minValue)==null?`--`:d,minDay:t?m(t.summary.minWeekdayKey):`--`})];return(0,C.jsx)(x,{titleKey:`page.heartRate.dataAnalysis`,Icon:e,items:(g.length>0?g:_).map(e=>typeof e==`string`?e:e.content),themeColor:h,className:n,isLoading:r})}function A({data:e,className:t,isLoading:n}){let{t:r}=u(),i=f.heartRate,o=e==null?void 0:e.weeklySummary;return(0,C.jsx)(v,{titleKey:`page.heartRate.weeklyOverview`,Icon:a,overallText:(o==null?void 0:o.overview)||r(`page.heartRate.defaultOverview`,{defaultValue:`Your heart rate is generally within the normal range this week. Keep up with your regular exercise routine!`}),highlightText:(o==null?void 0:o.highlights)||r(`page.heartRate.defaultHighlights`,{defaultValue:`The trend chart shows some fluctuations in your heart rate during the week. This is normal and can be influenced by physical activity, stress levels, and sleep quality.`}),highlightLabelKey:`page.heartRate.anomalyAlert`,highlightColor:`#FBBF24`,suggestions:o==null?void 0:o.suggestions,themeColor:i,className:t,isLoading:n})}var j={周一:`weekdays.mon`,周二:`weekdays.tue`,周三:`weekdays.wed`,周四:`weekdays.thu`,周五:`weekdays.fri`,周六:`weekdays.sat`,周日:`weekdays.sun`};function M(e){let t=new Date(e);return`${String(t.getMonth()+1).padStart(2,`0`)}/${String(t.getDate()).padStart(2,`0`)}`}function N(e){return e<60?`low`:e<=100?`normal`:e<=120?`elevated`:`high`}function P(e){return e===`up`||e===`down`||e===`stable`?e:`stable`}function F(e){var t,n,r,i,a,o,s,c,l,u,d;let f=((e==null||(t=e.trend_chart)==null?void 0:t.chart_data)||[]).map(e=>{var t,n,r,i,a,o;let s=new Date(e.date),c=(t=(n=e.max)==null?e.value:n)==null?0:t,l=(r=(i=e.min)==null?e.value:i)==null?0:r,u=(a=(o=e.avg)==null?e.value:o)==null?Math.round((c+l)/2):a;return{date:s,dateLabel:M(e.date),weekdayKey:j[e.label]||`weekdays.mon`,max:c,min:l,avg:u}}),p=(e==null?void 0:e.overview)||{},m=p.average||0,h=(n=p.max)==null?f.length>0?Math.max(...f.map(e=>e.max)):0:n,g=(r=p.min)==null?f.length>0?Math.min(...f.map(e=>e.min)):0:r,_=p.max_label&&j[p.max_label]||`weekdays.mon`,v=p.min_label&&j[p.min_label]||`weekdays.mon`,y=p.resting_avg,b=N(y||m),x=(e==null?void 0:e.comparison)||{},S=x.changes||{},C=P((i=S.average)==null?void 0:i.trend),w=((a=S.average)==null?void 0:a.value)||0,T=((o=x.previous)==null?void 0:o.average)||0,E=f.length>0?{value:f[f.length-1].avg,date:f[f.length-1].date}:null,D=(e==null?void 0:e.weekly_summary)||{};return{chartData:f,yAxisRange:(e==null||(s=e.trend_chart)==null?void 0:s.y_axis_range)||{min:40,max:160},averageLine:(e==null||(c=e.trend_chart)==null?void 0:c.average_line)||m,summary:{avgValue:m,minValue:g,maxValue:h,minWeekdayKey:v,maxWeekdayKey:_,previousAvg:T,avgResting:y,status:b,statusKey:`status.${b}`,trend:C,changeValue:w,totalCount:(e==null||(l=e.statistics)==null?void 0:l.total_count)||0,distribution:(e==null||(u=e.statistics)==null?void 0:u.distribution)||[]},comparison:{current:{average:((d=x.current)==null?void 0:d.average)||m},previous:{average:T},insight:x.insight||null},weeklySummary:{overview:D.overview||null,highlights:D.highlights||null,suggestions:D.suggestions||[],dataAnalysis:D.data_analysis||[]},latestReading:E}}const I={all:[`heart-rate`],trend:e=>[...I.all,`trend`,e==null?void 0:e.startDate,e==null?void 0:e.endDate],details:()=>[...I.all,`details`]};function L(e){return l({queryKey:I.trend(e),queryFn:async()=>{console.log(`[HR API] Fetching with dateRange:`,e);let t=await y(e?{start_date:e.startDate,end_date:e.endDate}:void 0);return console.log(`[HR API] Result:`,t),t},select:e=>F(e),staleTime:300*1e3,gcTime:600*1e3})}function R(){return b({featureName:`HR`,queryKeyFn:I.trend,fetchFn:e=>y({start_date:e.startDate,end_date:e.endDate})})}export{O as a,k as i,R as n,T as o,A as r,L as t};