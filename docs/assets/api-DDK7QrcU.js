import{C as e,E as t,O as n,T as r,at as i,h as a,r as o,rt as s,u as c}from"./vendor-DxyDeVV0.js";import{t as l}from"./vendor-query-BzUZE9-d.js";import{n as u}from"./vendor-i18n-BSzAmJZ7.js";import{c as d,l as f,o as p,s as m}from"./theme-XEO8amRP.js";import{t as h}from"./card-DR_iUne-.js";import{t as g}from"./DistributionCard-D_3pQ4Tr.js";import{t as _}from"./TrendLineChart-B7CWIoTy.js";import{t as v}from"./WeeklyOverviewCard-DICJkH00.js";import{r as y,t as b}from"./usePrefetchData-Dtc8Q6b7.js";var x=i(),S=s(),C=(0,x.memo)(({active:e,payload:t})=>{var n;let{t:r}=u();if(!e||!t||t.length===0)return null;let i=(n=t[0])==null?void 0:n.payload;return i?(0,S.jsxs)(`div`,{className:`bg-slate-700 text-white px-3 py-2 rounded-lg text-sm shadow-lg`,children:[(0,S.jsx)(`p`,{className:`font-medium mb-1`,children:r(i.weekdayKey)}),(0,S.jsxs)(`p`,{className:`text-amber-300`,children:[r(`common.max`),`: `,i.max,` `,r(`units.mmolL`)]}),(0,S.jsxs)(`p`,{className:`text-amber-200`,children:[r(`common.min`),`: `,i.min,` `,r(`units.mmolL`)]})]}):null});const w=(0,x.memo)(({data:e,className:n,isLoading:i})=>{var a,s,l,p,g,v,y,b,w,T,E,D,O,k,A,j,M;let{t:N}=u(),P=f.glucose,F=(0,x.useMemo)(()=>[{name:`Mon`,weekdayKey:`weekday.mon`,range:[4.5,6.5],avg:5.5,max:6.5,min:4.5},{name:`Tues`,weekdayKey:`weekday.tue`,range:[4.8,7],avg:5.8,max:7,min:4.8},{name:`Wed`,weekdayKey:`weekday.wed`,range:[4.6,6.8],avg:5.6,max:6.8,min:4.6},{name:`Thu`,weekdayKey:`weekday.thu`,range:[4.4,6.4],avg:5.4,max:6.4,min:4.4},{name:`Fri`,weekdayKey:`weekday.fri`,range:[4.7,6.9],avg:5.7,max:6.9,min:4.7},{name:`Sat`,weekdayKey:`weekday.sat`,range:[4.5,6.6],avg:5.5,max:6.6,min:4.5},{name:`Sun`,weekdayKey:`weekday.sun`,range:[4.6,6.7],avg:5.6,max:6.7,min:4.6}],[]),I=(0,x.useMemo)(()=>{var t,n;return(t=e==null||(n=e.chartData)==null?void 0:n.map((e,t)=>({name:[`Mon`,`Tues`,`Wed`,`Thu`,`Fri`,`Sat`,`Sun`][t%7],weekdayKey:e.weekdayKey,range:[e.min,e.max],avg:e.avg,max:e.max,min:e.min})))==null?F:t},[e==null?void 0:e.chartData,F]);return(0,S.jsxs)(h,{className:`${n} relative overflow-hidden`,children:[(0,S.jsx)(`div`,{className:`absolute inset-0 rounded-2xl flex items-center justify-center z-10 transition-all duration-300 ease-in-out ${i?`opacity-100`:`opacity-0 pointer-events-none`}`,style:{backgroundColor:d.loadingOverlay},children:(0,S.jsx)(c,{className:`w-8 h-8 text-white animate-spin`})}),(0,S.jsxs)(`div`,{className:`flex items-center gap-2 mb-4`,children:[(0,S.jsx)(o,{className:`w-5 h-5`,style:{color:P}}),(0,S.jsx)(`h3`,{className:`text-base font-semibold text-slate-800`,children:N(`page.glucose.trendyReport`)})]}),(0,S.jsxs)(`div`,{className:`rounded-xl px-5 py-4 mb-4 mx-1`,style:{backgroundColor:m.background.warning},children:[(0,S.jsxs)(`div`,{className:`flex items-start justify-between mb-4`,children:[(0,S.jsxs)(`div`,{children:[(0,S.jsx)(`p`,{className:`text-xs text-slate-500 mb-1`,children:N(`page.glucose.weeksAverage`)}),(0,S.jsxs)(`div`,{className:`flex items-baseline gap-1.5`,children:[(0,S.jsx)(`span`,{className:`text-3xl font-bold`,style:{color:P},children:(a=e==null||(s=e.summary)==null||(s=s.avgValue)==null?void 0:s.toFixed(1))==null?`--`:a}),(0,S.jsx)(`span`,{className:`text-lg text-slate-500`,children:N(`units.mmolL`)}),(()=>{if(!e)return null;let{trend:n,changeValue:i}=e.summary;if(i===0)return null;let a=n===`up`;return(0,S.jsxs)(`span`,{className:`flex items-center gap-0.5 text-sm`,style:{color:a?`#EF4444`:`#10B981`},children:[(0,S.jsx)(a?r:t,{className:`w-3 h-3`}),Math.abs(i).toFixed(1)]})})()]}),(0,S.jsxs)(`p`,{className:`text-xs text-slate-400 mt-0.5`,children:[N(`time.lastWeek`),`: `,(l=e==null||(p=e.summary)==null||(p=p.previousAvg)==null?void 0:p.toFixed(1))==null?`--`:l,` `,N(`units.mmolL`)]})]}),(0,S.jsx)(`div`,{className:`text-right text-xs text-slate-400 px-3 py-1.5 rounded-lg bg-white/60`,children:(0,S.jsxs)(`p`,{children:[N(`page.glucose.normalRange`),`: `,(g=e==null||(v=e.normalRange)==null?void 0:v.min)==null?3.9:g,`-`,(y=e==null||(b=e.normalRange)==null?void 0:b.max)==null?6.1:y,` `,N(`units.mmolL`)]})})]}),(0,S.jsxs)(`div`,{className:`flex gap-6`,children:[(0,S.jsxs)(`div`,{children:[(0,S.jsxs)(`span`,{className:`text-xs text-slate-400`,children:[N(`common.max`),`(`,e?N(e.summary.maxWeekdayKey):`--`,`)`]}),(0,S.jsxs)(`p`,{className:`text-xl font-semibold`,style:{color:P},children:[(w=e==null||(T=e.summary)==null||(T=T.maxValue)==null?void 0:T.toFixed(1))==null?`--`:w,` `,(0,S.jsx)(`span`,{className:`text-sm font-normal`,children:N(`units.mmolL`)})]})]}),(0,S.jsxs)(`div`,{children:[(0,S.jsxs)(`span`,{className:`text-xs text-slate-400`,children:[N(`common.min`),`(`,e?N(e.summary.minWeekdayKey):`--`,`)`]}),(0,S.jsxs)(`p`,{className:`text-xl font-semibold text-slate-600`,children:[(E=e==null||(D=e.summary)==null||(D=D.minValue)==null?void 0:D.toFixed(1))==null?`--`:E,` `,(0,S.jsx)(`span`,{className:`text-sm font-normal`,children:N(`units.mmolL`)})]})]})]})]}),(0,S.jsx)(_,{data:I,lines:[{dataKey:`avg`,areaDataKey:`range`,color:P,label:N(`page.glucose.mean`),showArea:!0,gradientId:`glucoseRangeGradient`,legendShape:`line`}],xAxisKey:`name`,yAxisDomain:[(O=e==null||(k=e.yAxisRange)==null?void 0:k.min)==null?3:O,(A=e==null||(j=e.yAxisRange)==null?void 0:j.max)==null?10:A],renderTooltip:e=>(0,S.jsx)(C,{...e}),referenceLine:{value:(M=e==null?void 0:e.averageLine)==null?5.5:M,color:P},height:224,chartMargin:{top:10,right:10,left:-15,bottom:0}})]})});var T=[`normal`,`high`,`too_high`,`too_low`],E={normal:`status.normal`,high:`status.high`,too_high:`status.tooHigh`,too_low:`status.tooLow`};function D({data:e,className:t,isLoading:r}){var i,a,o,s;let{t:c}=u(),l=f.glucose,d=(i=e==null||(a=e.summary)==null?void 0:a.distribution)==null?[]:i,m=(o=e==null||(s=e.summary)==null?void 0:s.totalCount)==null?0:o,h=(0,x.useMemo)(()=>T.map(e=>{let t=d.find(t=>t.type===e);return{type:e,label:c(E[e]||`status.${e}`),count:(t==null?void 0:t.count)||0,percent:(t==null?void 0:t.percent)||0,color:p.glucose[e]||`#94A3B8`}}),[d,c]),_=(0,x.useMemo)(()=>h.filter(e=>e.type===`normal`).reduce((e,t)=>e+(t.count||0),0),[h]);return(0,S.jsx)(g,{title:c(`page.glucose.statistics`),icon:n,themeColor:l,items:h,pieChartSize:`medium`,centerValue:c(`common.good`),centerLabel:c(`common.inAverage`),highlightValue:_,highlightLabel:`/ ${m} ${c(`common.times`)}`,highlightDescription:c(`page.glucose.normalResults`),gridColumns:2,className:t,isLoading:r})}function O({data:n,className:i,isLoading:a}){var o,s;let{t:l}=u(),p=f.glucose,m=(o=n==null?void 0:n.comparison)==null?{current:{average:0},previous:{average:0},insight:null}:o,g=(s=n==null?void 0:n.summary)==null?{changeValue:0,trend:`stable`,previousAvg:0,avgFasting:null,avgPostMeal:null}:s,_=e=>e===`up`?(0,S.jsx)(r,{className:`w-4 h-4`}):e===`down`?(0,S.jsx)(t,{className:`w-4 h-4`}):null,v=e=>e===`up`?`#EF4444`:e===`down`?`#10B981`:p,y=m.insight||l(`page.glucose.defaultInsight`,{defaultValue:`Your blood glucose is generally within the normal range. Keep maintaining a balanced diet and regular exercise habits for stable blood sugar levels.`});return(0,S.jsxs)(h,{className:`${i} relative overflow-hidden`,children:[(0,S.jsx)(`div`,{className:`absolute inset-0 rounded-2xl flex items-center justify-center z-10 transition-all duration-300 ease-in-out ${a?`opacity-100`:`opacity-0 pointer-events-none`}`,style:{backgroundColor:d.loadingOverlay},children:(0,S.jsx)(c,{className:`w-8 h-8 text-white animate-spin`})}),(0,S.jsxs)(`div`,{className:`flex items-center gap-2 mb-4`,children:[(0,S.jsx)(e,{className:`w-5 h-5`,style:{color:p}}),(0,S.jsx)(`h3`,{className:`text-base font-semibold text-slate-800`,children:l(`page.glucose.compareWithLastWeek`)})]}),(0,S.jsxs)(`div`,{className:`flex gap-3 mb-4`,children:[(0,S.jsxs)(`div`,{className:`flex-1 p-3 rounded-xl bg-slate-50`,children:[(0,S.jsx)(`p`,{className:`text-xs text-slate-500 mb-1`,children:l(`page.glucose.averageGlucose`)}),(0,S.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,S.jsx)(`span`,{className:`text-xl font-bold`,style:{color:p},children:n?m.current.average.toFixed(1):`--`}),(0,S.jsx)(`span`,{className:`text-sm text-slate-400`,children:l(`units.mmolL`)}),g.changeValue!==0&&(0,S.jsxs)(`div`,{className:`flex items-center gap-0.5 text-sm font-medium`,style:{color:v(g.trend)},children:[_(g.trend),Math.abs(g.changeValue).toFixed(1)]})]}),(0,S.jsxs)(`p`,{className:`text-xs text-slate-400 mt-1`,children:[l(`time.lastWeek`),`: `,n?n.summary.previousAvg.toFixed(1):`--`,l(`units.mmolL`)]})]}),g.avgFasting&&(0,S.jsxs)(`div`,{className:`flex-1 p-3 rounded-xl bg-slate-50`,children:[(0,S.jsx)(`p`,{className:`text-xs text-slate-500 mb-1`,children:l(`page.glucose.fastingLevel`)}),(0,S.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,S.jsx)(`span`,{className:`text-xl font-bold`,style:{color:p},children:g.avgFasting.toFixed(1)}),(0,S.jsx)(`span`,{className:`text-sm text-slate-400`,children:l(`units.mmolL`)})]}),(0,S.jsxs)(`p`,{className:`text-xs text-slate-400 mt-1`,children:[l(`page.glucose.fastingNormal`),`: 3.9-6.1`]})]}),!g.avgFasting&&g.avgPostMeal&&(0,S.jsxs)(`div`,{className:`flex-1 p-3 rounded-xl bg-slate-50`,children:[(0,S.jsx)(`p`,{className:`text-xs text-slate-500 mb-1`,children:l(`page.glucose.postMealLevel`)}),(0,S.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,S.jsx)(`span`,{className:`text-xl font-bold`,style:{color:p},children:g.avgPostMeal.toFixed(1)}),(0,S.jsx)(`span`,{className:`text-sm text-slate-400`,children:l(`units.mmolL`)})]}),(0,S.jsxs)(`p`,{className:`text-xs text-slate-400 mt-1`,children:[l(`page.glucose.postMealNormal`),`: <7.8`]})]})]}),(0,S.jsx)(`div`,{className:`p-4 rounded-2xl bg-amber-50`,children:(0,S.jsx)(`p`,{className:`text-sm text-slate-700 leading-relaxed`,children:y})})]})}function k({data:e,className:t,isLoading:n}){let{t:r}=u(),i=f.glucose,o=e==null?void 0:e.weeklySummary;return(0,S.jsx)(v,{titleKey:`page.glucose.weeklyOverview`,Icon:a,overallText:(o==null?void 0:o.overview)||r(`page.glucose.defaultOverview`,{defaultValue:`Your blood glucose levels are generally within the normal range this week. Keep up the good work with your diet and exercise habits!`}),highlightText:(o==null?void 0:o.highlights)||r(`page.glucose.defaultHighlights`,{defaultValue:`The trend chart shows some fluctuations in your blood glucose levels during the week. Pay attention to your diet, especially after meals, to maintain stable blood sugar levels.`}),highlightLabelKey:`page.glucose.needsAttention`,highlightColor:`#FBBF24`,suggestions:o==null?void 0:o.suggestions,themeColor:i,className:t,isLoading:n})}var A={周一:`weekdays.mon`,周二:`weekdays.tue`,周三:`weekdays.wed`,周四:`weekdays.thu`,周五:`weekdays.fri`,周六:`weekdays.sat`,周日:`weekdays.sun`},j={空腹:`vitals.fasting`,餐后:`vitals.postMeal`,随机:`common.value`};function M(e){let t=new Date(e);return`${String(t.getMonth()+1).padStart(2,`0`)}/${String(t.getDate()).padStart(2,`0`)}`}function N(e){return e<3.9?`low`:e<=6.1?`normal`:e<=7?`elevated`:`high`}function P(e){return e===`up`||e===`down`||e===`stable`?e:`stable`}function F(e){var t,n,r,i,a,o,s,c,l,u,d,f;console.log(`[Glucose Adapter] Input:`,e);let p=((e==null||(t=e.trend_chart)==null?void 0:t.chart_data)||[]).map(e=>{var t,n,r,i;let a=new Date(e.date),o=(t=(n=e.max)==null?e.value:n)==null?0:t,s=(r=(i=e.min)==null?e.value:i)==null?0:r;return{date:a,dateLabel:M(e.date),weekdayKey:A[e.label]||`weekdays.mon`,max:o,min:s,avg:(o+s)/2,typeKey:e.type?j[e.type]:void 0}}),m=(e==null?void 0:e.overview)||{},h=m.average||0,g=(n=m.max)==null?p.length>0?Math.max(...p.map(e=>e.max)):0:n,_=(r=m.min)==null?p.length>0?Math.min(...p.map(e=>e.min)):0:r,v=m.max_label&&A[m.max_label]||`weekdays.mon`,y=m.min_label&&A[m.min_label]||`weekdays.mon`,b=m.fasting_avg,x=m.post_meal_avg,S=N(b||h),C=(e==null?void 0:e.comparison)||{},w=C.changes||{},T=P((i=w.average)==null?void 0:i.trend),E=((a=w.average)==null?void 0:a.value)||0,D=((o=C.previous)==null?void 0:o.average)||0,O=p.length>0?{value:p[p.length-1].avg,typeKey:p[p.length-1].typeKey,date:p[p.length-1].date}:null,k=(e==null?void 0:e.normal_range)||(e==null||(s=e.trend_chart)==null?void 0:s.normal_range)||{min:3.9,max:6.1},F=(e==null?void 0:e.weekly_summary)||{},I={chartData:p,yAxisRange:(e==null||(c=e.trend_chart)==null?void 0:c.y_axis_range)||{min:2,max:9},averageLine:(e==null||(l=e.trend_chart)==null?void 0:l.average_line)||h,normalRange:k,summary:{avgValue:h,minValue:_,maxValue:g,minWeekdayKey:y,maxWeekdayKey:v,previousAvg:D,avgFasting:b,avgPostMeal:x,status:S,statusKey:`status.${S}`,trend:T,changeValue:E,totalCount:(e==null||(u=e.statistics)==null?void 0:u.total_count)||0,distribution:(e==null||(d=e.statistics)==null?void 0:d.distribution)||[]},comparison:{current:{average:((f=C.current)==null?void 0:f.average)||h},previous:{average:D},insight:C.insight||null},weeklySummary:{overview:F.overview||null,highlights:F.highlights||null,suggestions:F.suggestions||[],dataAnalysis:F.data_analysis||[]},latestReading:O};return console.log(`[Glucose Adapter] Output:`,I),I}const I={all:[`glucose`],trend:e=>[...I.all,`trend`,e==null?void 0:e.startDate,e==null?void 0:e.endDate],details:()=>[...I.all,`details`]};function L(e){return l({queryKey:I.trend(e),queryFn:async()=>{console.log(`[Glucose API] Fetching with dateRange:`,e);let t=await y(e?{start_date:e.startDate,end_date:e.endDate}:void 0);return console.log(`[Glucose API] Result:`,t),t},select:e=>F(e),staleTime:300*1e3,gcTime:600*1e3})}function R(){return b({featureName:`Glucose`,queryKeyFn:I.trend,fetchFn:e=>y({start_date:e.startDate,end_date:e.endDate})})}export{D as a,O as i,R as n,w as o,k as r,L as t};