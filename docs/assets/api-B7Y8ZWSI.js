import{t as e}from"./vendor-query-BzUZE9-d.js";import{n as t,t as n}from"./usePrefetchData-Dtc8Q6b7.js";var r={周一:`weekdays.mon`,周二:`weekdays.tue`,周三:`weekdays.wed`,周四:`weekdays.thu`,周五:`weekdays.fri`,周六:`weekdays.sat`,周日:`weekdays.sun`},i={正常血压:`normal`,正常:`normal`,正常高值:`high_normal`,低血压:`low_bp`,高血压:`high_bp`,过低:`low_bp`,过高:`high_bp`};function a(e){let t=new Date(e);return`${String(t.getMonth()+1).padStart(2,`0`)}/${String(t.getDate()).padStart(2,`0`)}`}function o(e,t){return e<90||t<60?`low`:e<120&&t<80?`normal`:e<130&&t<80?`elevated`:`high`}function s(e){var t,n,s,c,l,u,d,f,p,m,h,g,_,v;let y=((e==null||(t=e.trend_chart)==null?void 0:t.chart_data)||[]).map(e=>({date:new Date(e.date),dateLabel:a(e.date),weekdayKey:r[e.label]||`weekdays.mon`,systolic:e.systolic||0,diastolic:e.diastolic||0})),b=(e==null||(n=e.overview)==null?void 0:n.systolic_avg)||0,x=(e==null||(s=e.overview)==null?void 0:s.diastolic_avg)||0,S=o(b,x),C=(e==null?void 0:e.comparison)||{},w=((c=C.current)==null?void 0:c.systolic_avg)||b,T=((l=C.previous)==null?void 0:l.systolic_avg)||0,E=((u=C.current)==null?void 0:u.diastolic_avg)||x,D=((d=C.previous)==null?void 0:d.diastolic_avg)||0,O=w-T,k=E-D,A=O>0?`up`:O<0?`down`:`stable`,j=k>0?`up`:k<0?`down`:`stable`,M=Math.abs(O),N=Math.abs(k),P=y.length>0?{systolic:y[y.length-1].systolic,diastolic:y[y.length-1].diastolic,date:y[y.length-1].date}:null,F=((e==null||(f=e.statistics)==null?void 0:f.distribution)||[]).map(e=>({...e,type:i[e.label]||e.type||`normal`}));return{chartData:y,yAxisRange:(e==null||(p=e.trend_chart)==null?void 0:p.y_axis_range)||{min:60,max:160},summary:{avgSystolic:b,avgDiastolic:x,status:S,statusKey:`status.${S}`,systolicTrend:A,diastolicTrend:j,systolicChange:M,diastolicChange:N,totalCount:(e==null||(m=e.statistics)==null?void 0:m.total_count)||0,distribution:F},comparison:{current:{systolic:((h=C.current)==null?void 0:h.systolic_avg)||b,diastolic:((g=C.current)==null?void 0:g.diastolic_avg)||x},previous:{systolic:((_=C.previous)==null?void 0:_.systolic_avg)||0,diastolic:((v=C.previous)==null?void 0:v.diastolic_avg)||0},insight:C.insight||null},latestReading:P}}const c={all:[`blood-pressure`],trend:e=>[...c.all,`trend`,e==null?void 0:e.startDate,e==null?void 0:e.endDate],details:()=>[...c.all,`details`]};function l(n){return e({queryKey:c.trend(n),queryFn:async()=>{console.log(`[BP API] Fetching with dateRange:`,n);let e=await t(n?{start_date:n.startDate,end_date:n.endDate}:void 0);return console.log(`[BP API] Result:`,e),e},select:e=>s(e),staleTime:300*1e3,gcTime:600*1e3,placeholderData:e=>e})}function u(){return n({featureName:`BP`,queryKeyFn:c.trend,fetchFn:e=>t({start_date:e.startDate,end_date:e.endDate})})}export{u as n,l as t};